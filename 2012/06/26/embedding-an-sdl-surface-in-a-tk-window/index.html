<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
  <title>Embedding an SDL Surface in a Tk Window</title>
  <meta name="description" content="Tk is great, but sometimes it just isn't fast enough.  SDL is fast, but has no support for input dialogs and other GUI conventions.  By embedding an SDL surface ">
  <meta name="keywords" content="Retro Vintage Programming Tinkering"/>

  <!-- *** Twitter Card *** -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@techtinkering">
  <meta name="twitter:title" content="Embedding an SDL Surface in a Tk Window">
  <meta name="twitter:description" content="Tk is great, but sometimes it just isn't fast enough.  SDL is fast, but has no support for input dialogs and other GUI conventions.  By embedding an SDL surface ">
  <!-- *** Twitter Card *** -->

  <!-- *** Open Graph *** --->
  <meta property="og:type" content="website">
  <meta property="og:title" content="Embedding an SDL Surface in a Tk Window">
  <meta property="og:description" content="Tk is great, but sometimes it just isn't fast enough.  SDL is fast, but has no support for input dialogs and other GUI conventions.  By embedding an SDL surface ">
  <meta property="og:url" content="https://techtinkering.com/2012/06/26/embedding-an-sdl-surface-in-a-tk-window/">
  <!-- *** Open Graph *** --->

  <script>
    console.log('timeZone: '+Intl.DateTimeFormat().resolvedOptions().timeZone);
    function isUserFromUK() {
      return Intl.DateTimeFormat().resolvedOptions().timeZone == "Europe/London";
    }
  </script>

  <link href="/css/main.css" rel="stylesheet">
  <link href="/css/article.css" rel="stylesheet">
  <link rel="canonical" href="https://techtinkering.com/2012/06/26/embedding-an-sdl-surface-in-a-tk-window/">
  <link rel="alternate" type="application/atom+xml" title="TechTinkering - Retro Computers, Programming, General Technical Tinkering"
        href="https://techtinkering.com/feed.xml" />

	<!-- ****** faviconit.com favicons ****** -->
	<link rel="shortcut icon" href="/favicon.ico">
	<link rel="icon" sizes="16x16 32x32 64x64" href="/favicon.ico">
	<!-- ****** faviconit.com favicons ****** -->

  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->

</head>
  <body>
    <nav>
  <div class="container">
    <div class="navbar-header">
      <a href="/">TechTinkering</a><br />
      =============
    </div>

    <div class="contact">
      <ul>
        <li>
          <a href="https://twitter.com/TechTinkering" title="@TechTinkering on Twitter">Twitter</a>
        </li>
        <li>
          <a href="https://youtube.com/techtinkering" title="TechTinkering's YouTube Channel">YouTube</a>
        </li>
        <li>
          <a href="/feed.xml" title="Subscribe to our Atom Feed">Feed</a>
        </li>
        <li>
          <a href="mailto:techtinkering@vlifesystems.com" title="Email us, we'd love to hear from you">Email</a>
        </li>
        <li>
          <a href="/useful-links/" title="Useful vintage computer links">Useful Links</a>
        </li>
      </ul>
    </div>
  </div>
</nav>
    <div id="content" class="container">
      <div class="margin-buffer">
    <article itemscope itemtype="http://schema.org/BlogPosting">
      <header>
        <a href="/2012/06/26/embedding-an-sdl-surface-in-a-tk-window/" title="Embedding an SDL Surface in a Tk Window">
          <h1 itemprop="headline name">Embedding an SDL Surface in a Tk Window</h1>
        </a>
        <div>
            <time itemprop="datePublished"
                  datetime="2012-06-26">
              26 June 2012
            </time>
          <span itemscope itemprop="publisher"
                itemtype="http://schema.org/Organization">
            <meta itemprop="name" content="TechTinkering" />
            <meta itemprop="url" content="https://techtinkering.com" />
          </span>
          <span itemscope itemprop="author" itemtype="http://schema.org/Person">
            <a rel="author" itemprop="url" href="https://lawrencewoodman.github.io">
              <span itemprop="name">Lawrence Woodman</span>
            </a>
          </span>

          <ul class="tags">
              <li>#<a href="/articles/tag/programming/">Programming</a></li>
              <li>#<a href="/articles/tag/sdl/">SDL</a></li>
              <li>#<a href="/articles/tag/tcl/">Tcl</a></li>
              <li>#<a href="/articles/tag/tk/">Tk</a></li>
          </ul>
        </div>
      </header>

        <div itemprop="articleBody">
        <p>Tk is great, but sometimes it just isn't fast enough.  SDL is fast, but has no support for input dialogs and other GUI conventions.  By embedding an SDL surface in a Tk window you get the best of both worlds.  Whether you want to use Tk to add a nice GUI to an SDL app or want to access SDL via Tcl/Tk, this article will show you how.</p>
<h2>Embedding the SDL Surface</h2>
<p>To embed an SDL surface in another window you have to alter the <code>SDL_WINDOWID</code> environmental variable so that it matches the ID of the window that you want the SDL surface embedded in.  This must be done after the main window is displayed and before <code>SDL_Init()</code> is called.</p>
<p>To ensure that the Tk window is displayed you need to call something like:</p>
<pre><code class="language-c">Tcl_Eval(interp, &quot;update&quot;);
</code></pre>
<p>From Tcl you must provide a window for the SDL surface to be embedded in.  This should have the <code>background</code> set to <code>&quot;&quot;</code> otherwise you will get problems when other windows cover it:</p>
<pre><code class="language-tcl">frame .screen -width 400 -height 400 -background &quot;&quot;
</code></pre>
<p>Then to get the window ID and set <code>SDL_WINDOWID</code>:</p>
<pre><code class="language-c">int
setSDLWindowID(Tcl_Interp *interp)
{
  Tcl_Obj *result;
  char *windowID;
  char envBuf[50];

  /* .screen here is the name of the widget that you want to overwrite,
     this is normally a frame */
  if (Tcl_Eval(interp, &quot;winfo id .screen&quot;) == TCL_ERROR)
    return 0;

  result = Tcl_GetObjResult(interp);
  Tcl_GetStringFromObj(windowID, NULL);

  snprintf(envBuf, 50, &quot;SDL_WINDOWID=%s&quot;, windowID);
  SDL_putenv(buf);

  return 1;
}
</code></pre>
<p>The above uses <code>SDL_putenv()</code> rather than <code>putenv()</code> as this is recommended by an old <a href="http://sdl.beuc.net/sdl.wiki/FAQ_GUI">SDL GUI FAQ</a></p>
<p>From this point you can call <code>SDL_Init()</code> and <code>SDL_SetVideoMode()</code>, but do remember to use the <code>SDL_NOFRAME</code> attribute:</p>
<pre><code class="language-c">SDL_Surface *
initScreenSurface(int width, int height, int depth)
{
  SDL_Surface *sfScreen;

  if (SDL_Init(SDL_INIT_EVERYTHING) &lt; 0) {
    fprintf(stderr, &quot;Couldn't initialize SDL: %s\n&quot;, SDL_GetError());
    return NULL;
  }

  sfScreen = SDL_SetVideoMode(width, height, depth,
                              SDL_NOFRAME|SDL_SWSURFACE|SDL_ANYFORMAT);
  if (sfScreen == NULL) {
    fprintf(stderr, &quot;Couldn't initialize SDL: %s\n&quot;, SDL_GetError());
    return NULL;
  }

  return sfSreen;
}
</code></pre>
<h2>The Event Loop</h2>
<p>You must have an event loop that calls both <code>SDL_PollEvent()</code> and <code>Tk_DoOneEvent()</code>.  The events will be handled mostly by Tk.  However, you do need to detect <code>SDL_QUIT</code> from <code>SDL_PollEvent()</code> because SDL converts <code>SIGTERM</code> to this.</p>
<pre><code class="language-c">void
event_loop()
{
  SDL_Event event;

  while (!(SDL_PollEvent(&amp;event) &amp;&amp; event.type == SDL_QUIT)) {
    Tk_DoOneEvent(TK_ALL_EVENTS|TK_DONT_WAIT);
  }
}
</code></pre>
<h3>Handling Key Release Events</h3>
<p>From Tcl you can handle whichever events you need to detect.  For example to bind the <code>&lt;KeyRelease&gt;</code> event to a key handler:</p>
<pre><code class="language-tcl">proc handleKey {key} {
  switch -regexp -- $key {
    .*Up$ {ball up}
    .*Down$ {ball down}
    .*Left$ {ball left}
    .*Right$ {ball right}
  }
}
bind all &lt;KeyRelease&gt; {handleKey %K}
</code></pre>
<h3>Handling Expose Events</h3>
<p>SDL also needs to know when the screen should be redrawn. From Tcl:</p>
<pre><code class="language-tcl">bind . &lt;Expose&gt; {screen_refresh}
</code></pre>
<p>And to provide the <code>screen_refresh</code> command:</p>
<pre><code class="language-c">static SDL_Surface *sfScreen = NULL;

void
screenRefresh(void)
{
  if (sfScreen != NULL)
    SDL_Flip(sfScreen);
}

static int
ScreenRefreshCmd(ClientData clientData, Tcl_Interp *interp,
                 int objc, Tcl_Obj *CONST objv[])
{
  if (objc != 1) {
    Tcl_WrongNumArgs(interp, 1, objv, &quot;&quot;);
  }

  screenRefresh();
  return TCL_OK;
}

void createCommands(Tcl_Interp *interp)
{
  Tcl_CreateObjCommand(interp, &quot;screen_refresh&quot;, ScreenRefreshCmd,
                       (ClientData) NULL,
                       (Tcl_CmdDeleteProc *) NULL);
}
</code></pre>
<h2>A Small Demonstration</h2>
<p>I have created the <a href="https://github.com/LawrenceWoodman/sdl_and_tk_demo">sdl_and_tk_demo</a> on github to demonstrate how to put this altogether.  The README contains information on how to compile and run the demo.  This demo was inspired by <a href="http://www-users.cs.umn.edu/~mein/">Kent Mein</a>'s <a href="http://www.libsdl.org/projects/tcl-demo/">SDL and Tk MDI demo</a>.</p>
      </div>
    </article>
</div>

  <div id="cclicence">
    <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
      <img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png" />
    </a>
    <br />
    <span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">Embedding an SDL Surface in a Tk Window</span>
    by <a xmlns:cc="http://creativecommons.org/ns#" href="https://techtinkering.com/2012/06/26/embedding-an-sdl-surface-in-a-tk-window/" property="cc:attributionName" rel="cc:attributionURL">Lawrence Woodman</a>
   is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
   
  </div>


  <div class="discuss">
    <h2 style="margin-top:0;">Share This Post</h2>
    <div class="contact">
  <ul>
    <li><a href="http://www.reddit.com/submit?url=https%3A%2F%2Ftechtinkering.com%2F2012%2F06%2F26%2Fembedding-an-sdl-surface-in-a-tk-window%2F&title=Embedding%20an%20SDL%20Surface%20in%20a%20Tk%20Window" target="_blank" title="Submit to Reddit">Reddit</a></li>
    <li><a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Ftechtinkering.com%2F2012%2F06%2F26%2Fembedding-an-sdl-surface-in-a-tk-window%2F&quote=Embedding%20an%20SDL%20Surface%20in%20a%20Tk%20Window" target="_blank" title="Share on Facebook">Facebook</a></li>
    <li><a href="https://twitter.com/intent/tweet?source=https%3A%2F%2Ftechtinkering.com%2F2012%2F06%2F26%2Fembedding-an-sdl-surface-in-a-tk-window%2F&text=Embedding%20an%20SDL%20Surface%20in%20a%20Tk%20Window:%0Ahttps%3A%2F%2Ftechtinkering.com%2F2012%2F06%2F26%2Fembedding-an-sdl-surface-in-a-tk-window%2F&via=TechTinkering" target="_blank" title="Tweet">Twitter</a></li>
    <li><a href="mailto:?subject=Embedding%20an%20SDL%20Surface%20in%20a%20Tk%20Window&body=Tk%20is%20great%2C%20but%20sometimes%20it%20just%20isn%27t%20fast%20enough.%20%20SDL%20is%20fast%2C%20but%20has%20no%20support%20for%20input%20dialogs%20and%20other%20GUI%20conventions.%20%20By%20embedding%20an%20SDL%20surface%20in%20a%20Tk%20window%20you%20get%20the%20best%20of%20both%20...:%0A%0Ahttps%3A%2F%2Ftechtinkering.com%2F2012%2F06%2F26%2Fembedding-an-sdl-surface-in-a-tk-window%2F" target="_blank" title="Send email">Email</a></li>
  </ul>
</div>

    <h2>Feedback/Discuss</h2>
    <div class="contact">
  <ul>


    <li><a href="mailto:techtinkering@vlifesystems.com?subject=Comment:%20Embedding%20an%20SDL%20Surface%20in%20a%20Tk%20Window&body=Article%20URL:%20https%3A%2F%2Ftechtinkering.com%2F2012%2F06%2F26%2Fembedding-an-sdl-surface-in-a-tk-window%2F%0A" title="Send us an email">Email</a></li>
  </ul>
</div>
  </div>


    <div>
    <h2>Related Articles</h2>
    <div class="margin-buffer">
      <header>
  <h2><a href="/articles/introducing-ornament-a-tcl-template-module/">Introducing Ornament a Tcl Template Module</a></h2>
  <span class="post-meta">
      <ul class="tags">
          <li>#<a href="/articles/tag/ornament/">Ornament</a></li>
          <li>#<a href="/articles/tag/programming/">Programming</a></li>
          <li>#<a href="/articles/tag/tcl/">Tcl</a></li>
      </ul>
  </span>
</header>
<div>
  Ornament is a Tcl template module that allows you to define, parse and compile a template to produce a script which can then be run using a safe interpreter.  The idea came from the Templates and subst...
  &nbsp;
  <a class="readMore" href="/articles/introducing-ornament-a-tcl-template-module/">Read More</a>
</div>
<br />
      <header>
  <h2><a href="/2013/02/27/xdgbasedir-a-tcl-module-to-access-the-xdg-base-directory-specification/">xdgbasedir: A Tcl Module to Access the XDG Base Directory Specification</a></h2>
  <span class="post-meta">
      <ul class="tags">
          <li>#<a href="/articles/tag/programming/">Programming</a></li>
          <li>#<a href="/articles/tag/tcl/">Tcl</a></li>
      </ul>
  </span>
</header>
<div>
  Unix has traditionally lacked a consistent way of storing user specific and system wide configuration and support files.  This has lead to a mess of dot files in a user's home directory and other assoc...
  &nbsp;
  <a class="readMore" href="/2013/02/27/xdgbasedir-a-tcl-module-to-access-the-xdg-base-directory-specification/">Read More</a>
</div>
<br />
      <header>
  <h2><a href="/2013/02/20/compiling-a-tcl-script-into-an-executable/">Compiling a Tcl Script into an Executable</a></h2>
  <span class="post-meta">
      <ul class="tags">
          <li>#<a href="/articles/tag/c/">C</a></li>
          <li>#<a href="/articles/tag/programming/">Programming</a></li>
          <li>#<a href="/articles/tag/tcl/">Tcl</a></li>
      </ul>
  </span>
</header>
<div>
  Locating Tcl scripts to load from an executable can be awkward if you want to make your program cross-platform.  An easier way is to compile a Tcl script directly into the executable and let that scrip...
  &nbsp;
  <a class="readMore" href="/2013/02/20/compiling-a-tcl-script-into-an-executable/">Read More</a>
</div>
<br />
      <header>
  <h2><a href="/articles/modula-2-compilers-on-cpm/">Modula-2 Compilers on CP/M</a></h2>
  <span class="post-meta">
      <ul class="tags">
          <li>#<a href="/articles/tag/cpm/">CP/M</a></li>
          <li>#<a href="/articles/tag/modula-2/">Modula-2</a></li>
          <li>#<a href="/articles/tag/programming/">Programming</a></li>
          <li>#<a href="/articles/tag/retro/">Retro</a></li>
      </ul>
  </span>
</header>
<div>
  Modula-2 is a great language in general and is a good choice for programming on CP/M.  There are three good compilers available for CP/M which all require a Z80 processor and we'll compare each in turn...
  &nbsp;
  <a class="readMore" href="/articles/modula-2-compilers-on-cpm/">Read More</a>
</div>
<br />
      <header>
  <h2><a href="/articles/is-subleq-the-right-choice-for-a-vm/">Is SUBLEQ the Right Choice for a VM?</a></h2>
  <span class="post-meta">
      <ul class="tags">
          <li>#<a href="/articles/tag/programming/">Programming</a></li>
          <li>#<a href="/articles/tag/subleq/">SUBLEQ</a></li>
      </ul>
  </span>
</header>
<div>
  SUBLEQ is an interesting architecture because of its simplicity, adaptability and power.  It is therefore an attractive choice for a simple virtual machine.  However, this comes at a cost which we will...
  &nbsp;
  <a class="readMore" href="/articles/is-subleq-the-right-choice-for-a-vm/">Read More</a>
</div>
<br />
</div>
    </div>

    </div>

    <footer>
  <nav>
    <div class="container">
      <div>
        <strong>Legal:</strong>
        <a href="/terms/">T & C</a>, <a href="/privacy/">Privacy Policy</a>
        &nbsp;
        <strong>Misc:</strong>
        <a href="https://github.com/lawrencewoodman/techtinkering.com" title="Fork TechTinkering On GitHub ">GitHub</a>
      </div>
    </div>
  </nav>
</footer>
  </body>
</html>