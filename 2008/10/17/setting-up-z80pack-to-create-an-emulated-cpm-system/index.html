<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
  <title>Setting up z80pack to Create an Emulated CP/M System</title>
  <meta name="description" content="I have decided to try out some old CP/M software, but need something to run it on.  I could either do this on my Commodore 128 or through emulation.  Unfortunate">
  <meta name="keywords" content="Retro Vintage Programming Tinkering"/>

  <!-- *** Twitter Card *** -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@techtinkering">
  <meta name="twitter:title" content="Setting up z80pack to Create an Emulated CP/M System">
  <meta name="twitter:description" content="I have decided to try out some old CP/M software, but need something to run it on.  I could either do this on my Commodore 128 or through emulation.  Unfortunate">
  <!-- *** Twitter Card *** -->

  <!-- *** Open Graph *** --->
  <meta property="og:type" content="website">
  <meta property="og:title" content="Setting up z80pack to Create an Emulated CP/M System">
  <meta property="og:description" content="I have decided to try out some old CP/M software, but need something to run it on.  I could either do this on my Commodore 128 or through emulation.  Unfortunate">
  <meta property="og:url" content="https://techtinkering.com/2008/10/17/setting-up-z80pack-to-create-an-emulated-cpm-system/">
  <!-- *** Open Graph *** --->

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-4388762-2"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-4388762-2');
  </script>

  <script>
    console.log('timeZone: '+Intl.DateTimeFormat().resolvedOptions().timeZone);
    function isUserFromUK() {
      return Intl.DateTimeFormat().resolvedOptions().timeZone == "Europe/London";
    }
  </script>

  <link href="/css/main.css" rel="stylesheet">
  <link href="/css/article.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" rel="stylesheet" type="text/css" />
  <link rel="canonical" href="https://techtinkering.com/2008/10/17/setting-up-z80pack-to-create-an-emulated-cpm-system/">
  <link rel="alternate" type="application/rss+xml" title="TechTinkering - Retro Computers, Programming, General Technical Tinkering"
        href="https://feedproxy.google.com/TechTinkering" />

	<!-- ****** faviconit.com favicons ****** -->
	<link rel="shortcut icon" href="/favicon.ico">
	<link rel="icon" sizes="16x16 32x32 64x64" href="/favicon.ico">
	<!-- ****** faviconit.com favicons ****** -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>

  <script>
    if (isUserFromUK()) {
      console.log("No Google ADs - UK user");
    } else {
      console.log("Google ADs - not from uk");
      document.write('<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"><' + '/script>');
    }
  </script>

  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->

  <script>
    // Cookie Consent - https://cookieconsent.insites.com
    window.addEventListener("load", function(){
    window.cookieconsent.initialise({
      "palette": {
        "popup": {
          "background": "#252e39"
        },
        "button": {
          "background": "#14a7d0"
        }
      },
      "theme": "classic",
      "position": "top",
      "static": true,
      "content": {
        "message": "TechTinkering uses cookies for advertising, analytics, etc.",
        "href": "https://techtinkering.com/privacy/"
      }
    })});
  </script>

  <script>
    if (isUserFromUK()) {
      console.log("No Google Ads - uk user");
    } else {
      console.log("Google Ads - non-uk user");
      (adsbygoogle = window.adsbygoogle || []).push({
           google_ad_client: "ca-pub-1613732348909658",
           enable_page_level_ads: true
      });
    }
  </script>

  <script>
    if (isUserFromUK()) {
      console.log("Amazon Banner - from uk");
      // Amazon Prime Video Banner 728x90 and 300x250
      amznBanner='<div class="amazonBannerDesktop"><iframe src="https://rcm-eu.amazon-adsystem.com/e/cm?o=2&p=48&l=ur1&category=piv&banner=0E183RXMV88X6J8GJ002&f=ifr&linkID=a2c37aae0561f075af3356504493bdf0&t=techtinkering-21&tracking_id=techtinkering-21" width="728" height="90" scrolling="no" border="0" marginwidth="0" style="border:none;" frameborder="0" sandbox="allow-scripts allow-same-origin allow-popups allow-top-navigation-by-user-activation"><' + '/iframe><' +'/div><div class="amazonBannerMobile"><iframe src="https://rcm-eu.amazon-adsystem.com/e/cm?o=2&p=12&l=ur1&category=piv&banner=070GKT77WVHAHSRTHK02&f=ifr&linkID=0dc57b53bcc8f7ab67a385d51155e57a&t=techtinkering-21&tracking_id=techtinkering-21" width="300" height="250" scrolling="no" border="0" marginwidth="0" style="border:none;" frameborder="0" sandbox="allow-scripts allow-same-origin allow-popups allow-top-navigation-by-user-activation"><' + '/iframe><' + '/div>';
    }
  </script>
</head>
  <body>
    <nav>
  <div class="container">
    <div class="navbar-header">
      <a href="/">TechTinkering</a><br />
      =============
    </div>

    <div class="contact">
      <ul>
        <li>
          <a href="https://twitter.com/TechTinkering" title="@TechTinkering on Twitter">Twitter</a>
        </li>
        <li>
          <a href="https://youtube.com/techtinkering" title="TechTinkering's YouTube Channel">YouTube</a>
        </li>
        <li>
          <a href="https://feeds.feedburner.com/TechTinkering" title="Subscribe to our RSS Feed">RSS</a>
        </li>
        <li>
          <a href="mailto:techtinkering@vlifesystems.com" title="Email us, we'd love to hear from you">Email</a>
        </li>
        <li>
          <a href="/useful-links/" title="Useful vintage computer links">Useful Links</a>
        </li>
      </ul>
    </div>
  </div>
</nav>
    <div id="content" class="container">
          <script language="javascript" type="text/javascript">
      window.location.replace("/articles/emulating-a-cpm-system-with-z80pack/")
    </script>

    <div class="margin-buffer articleRedirected">
      <h1>Old Article</h1>
      <p>This is an old article which is only being kept for historical purposes.</p>

      <p>Please navigate and update any links to the new article: <a href="/articles/emulating-a-cpm-system-with-z80pack/">Emulating a CP/M System with z80pack</a>.</p>
    </div>
<div class="margin-buffer">
    <article itemscope itemtype="http://schema.org/BlogPosting">
      <header>
        <a href="/2008/10/17/setting-up-z80pack-to-create-an-emulated-cpm-system/" title="Setting up z80pack to Create an Emulated CP/M System">
          <h1 itemprop="headline name">Setting up z80pack to Create an Emulated CP/M System</h1>
        </a>
        <div>
            <time itemprop="datePublished"
                  datetime="2008-10-17">
              17 October 2008
            </time>
          <span itemscope itemprop="publisher"
                itemtype="http://schema.org/Organization">
            <meta itemprop="name" content="TechTinkering" />
            <meta itemprop="url" content="https://techtinkering.com" />
          </span>
          <span itemscope itemprop="author" itemtype="http://schema.org/Person">
            <a rel="author" itemprop="url" href="https://lawrencewoodman.github.io">
              <span itemprop="name">Lawrence Woodman</span>
            </a>
          </span>

          <ul class="tags">
              <li>#<a href="/articles/tag/cpm/">CP/M</a></li>
              <li>#<a href="/articles/tag/emulation/">Emulation</a></li>
              <li>#<a href="/articles/tag/retro/">Retro</a></li>
              <li>#<a href="/articles/tag/z80/">Z80</a></li>
          </ul>
        </div>
      </header>
        <div itemprop="articleBody">
        <p>I have decided to try out some old CP/M software, but need something to run it on.  I could either do this on my Commodore 128 or through emulation.  Unfortunately the 1571 disk drive for my Commodore is currently out of action, so that leaves me with emulation.  I was going to use <a href="http://vice-emu.sourceforge.net/">vice</a> to emulate a C128, but have always found it a pain to get CP/M files onto .D64/71 disk images.  After looking around for the best emulator to run CP/M on, I came up with either <a href="http://www.mathematik.uni-ulm.de/users/ag/yaze-ag/">YAZE-AG</a> or <a href="http://www.autometer.de/unix4fun/z80pack/">z80pack</a>.  z80pack seems to be better supported, has more documentation and is being actively developed, so that's the one I have chosen for this article.</p>
<h2>Installing z80pack</h2>
<ul>
<li>First download the source (z80pack-x.y.tgz, currently z80pack-1.17.tgz) for <a href="http://www.autometer.de/unix4fun/z80pack/" title="A mirror of Udo Munk's old site">z80 pack</a> from <a href="http://www.autometer.de/unix4fun/z80pack/ftp/">here</a>.  The following <a href="http://www.autometer.de/unix4fun/z80pack/#dri_quick" title="Installation instructions for z80pack">installation instructions</a> are taken from the z80pack site.  More information can be found there, in particular, information on installing z80pack on non Linux/Unix systems.</li>
<li>Unpack the source archive in your home directory:
<pre><code class="language-bash">$ tar xzvf z80pack-x.y.tgz
</code></pre>
</li>
<li>Change the directory it is extracted to, to make this article easier to explain.  There is no need for you to do this.
<pre><code class="language-bash">$ mv z80pack-1.16 z80pack
</code></pre>
</li>
<li>Compile the emulator:
<pre><code class="language-bash">$ cd ~/z80pack/cpmsim/srcsim
$ make
$ make clean
</code></pre>
</li>
<li>Compile the support programs:
<pre><code class="language-bash">$ cd ~/z80pack/cpmsim/srctools
$ make
$ make clean
</code></pre>
</li>
</ul>
<p>This leaves, on Linux, a few bash scripts in the <code>~/z80pack/cpmsim/</code> directory, <code>cpm2</code>, <code>cpm3</code>, <code>mpm</code>, which automatically start the emulator by booting into CP/M 2.2, CP/M 3.0, MP/M, etc.</p>
<h2>Creating disk images</h2>
<p>We now needed to create some disk images; to do this I recommend <a href="http://www.moria.de/~michael/cpmtools/">Cpmtools</a> which is a part of many Linux distros.  If you don't have this as part of your distro, the source can be downloaded from <a href="http://www.moria.de/~michael/cpmtools/cpmtools-2.7.tar.gz">here</a>.  Cpmtools is a great collection of tools used to manipulate CP/M images and file systems in a variety of formats and works well with z80pack.</p>
<h3>Create a 4Mb Hard Disk Image</h3>
<p>It would be useful to create a 4Mb Hard Disk Image, as this may be needed if we want to use any bigger applications such as a C compiler.  To create this we can use Cpmtools, but first we need to make sure that it has the correct disk definition by editing <code>/etc/cpmtools/diskdefs</code> and adding the following lines:</p>
<pre><code class="language-text"># 4mb HDD for z80pack
diskdef hd
  seclen 128
  tracks 255
  sectrk 128
  blocksize 2048
  maxdir 1024
  skew 0
  boottrk 0
  os 3.0
end
</code></pre>
<p>CP/M has 16 'user areas' which can be used to organize data on a disk.  They are effectively like a crude directory system. User area 0 is the default and the only one we will work with in this article.</p>
<p>To create a blank 4Mb Hard Disk image called <code>main.hd4.cpm</code>, run:</p>
<pre><code class="language-bash">$ mkfs.cpm -fhd main.hd4.cpm
</code></pre>
<p>Then to copy all the <code>.COM</code> files from the current directory into the image in user area 0, run:</p>
<pre><code class="language-bash">$ cpmcp -fhd hd4.cpm *.COM 0:
</code></pre>
<h3>Create a Floppy Diskette Image</h3>
<p>To create a floppy diskette image called, <code>work.dsk.cpm</code>, run:</p>
<pre><code class="language-bash">$ mkfs.cpm work.dsk.cpm
</code></pre>
<p>Then to copy all the <code>.DOC</code> files from the current directory into the image in user area 0: run:</p>
<pre><code class="language-bash">$ cpmcp work.dsk.cpm *.DOC 0:
</code></pre>
<h2>Configuring z80pack</h2>
<p>We now have a 4mb disk image and a floppy disk image.  We can connect them to the emulator by creating a script in the <code>~/z80pack/cpmsim/</code> directory called <code>work</code>.  First copy <code>main.hd4.cpm</code> and <code>work.dsk.cpm</code> to the <code>~z80pack/cpmsim/disks/library/</code> directory.  It is also worth copying them to the backups directory as well: <code>~/z80pack/cpmsim/disks/backups/</code></p>
<p>Now create a script in <code>~/z80pack/cpmsim/</code> called <code>work</code> to start z80pack with our disk image files attached:</p>
<pre><code class="language-bash">#!/bin/sh
rm -f disks/drive[abci].cpm
ln disks/library/cpm3-1.dsk disks/drivea.cpm
ln disks/library/cpm3-2.dsk disks/driveb.cpm
ln disks/library/work.dsk.cpm disks/drivec.cpm
ln disks/library/main.hd4.cpm disks/drivei.cpm
./cpmsim -f4
</code></pre>
<p>This attaches the two CP/M disks on drive A and B, our <code>work.dsk.cpm</code> image on drive C, and our <code>main.hd4.cpm</code> image on I:
The line <code>./cpmsim -f4</code> tells the emulator to run at 4Mhz, which makes it a bit more realistic.</p>
<h2>Starting the emulator</h2>
<p>From the <code>~/z80pack/cpmsim/</code> directory, run the script we created:</p>
<pre><code class="language-bash">$ ./work
</code></pre>
<p>The CP/M operating system will now boot up and leave you at the <code>A&gt;</code> prompt.</p>
<p>To leave the emulator type:</p>
<pre><code class="language-text">A&gt; a:bye
</code></pre>
      </div>
    </article>
</div>

<script>
  if (isUserFromUK()) {
    document.write(amznBanner);
  }
</script>

  <div id="cclicence">
    <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
      <img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png" />
    </a>
    <br />
    <span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">Setting up z80pack to Create an Emulated CP/M System</span>
    by <a xmlns:cc="http://creativecommons.org/ns#" href="https://techtinkering.com/2008/10/17/setting-up-z80pack-to-create-an-emulated-cpm-system/" property="cc:attributionName" rel="cc:attributionURL">Lawrence Woodman</a>
   is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
   
  </div>


  <div class="discuss">
    <h2 style="margin-top:0;">Share This Post</h2>
    <div class="contact">
  <ul>
    <li><a href="http://www.reddit.com/submit?url=https%3A%2F%2Ftechtinkering.com%2F2008%2F10%2F17%2Fsetting-up-z80pack-to-create-an-emulated-cpm-system%2F&title=Setting%20up%20z80pack%20to%20Create%20an%20Emulated%20CP%2FM%20System" target="_blank" title="Submit to Reddit">Reddit</a></li>
    <li><a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Ftechtinkering.com%2F2008%2F10%2F17%2Fsetting-up-z80pack-to-create-an-emulated-cpm-system%2F&quote=Setting%20up%20z80pack%20to%20Create%20an%20Emulated%20CP%2FM%20System" target="_blank" title="Share on Facebook">Facebook</a></li>
    <li><a href="https://twitter.com/intent/tweet?source=https%3A%2F%2Ftechtinkering.com%2F2008%2F10%2F17%2Fsetting-up-z80pack-to-create-an-emulated-cpm-system%2F&text=Setting%20up%20z80pack%20to%20Create%20an%20Emulated%20CP%2FM%20System:%0Ahttps%3A%2F%2Ftechtinkering.com%2F2008%2F10%2F17%2Fsetting-up-z80pack-to-create-an-emulated-cpm-system%2F&via=TechTinkering" target="_blank" title="Tweet">Twitter</a></li>
    <li><a href="mailto:?subject=Setting%20up%20z80pack%20to%20Create%20an%20Emulated%20CP%2FM%20System&body=I%20have%20decided%20to%20try%20out%20some%20old%20CP%2FM%20software%2C%20but%20need%20something%20to%20run%20it%20on.%A0%20I%20could%20either%20do%20this%20on%20my%20Commodore%20128%20or%20through%20emulation.%A0%20Unfortunately%20the%201571%20disk%20drive%20for%20my%20Commodore%20...:%0A%0Ahttps%3A%2F%2Ftechtinkering.com%2F2008%2F10%2F17%2Fsetting-up-z80pack-to-create-an-emulated-cpm-system%2F" target="_blank" title="Send email">Email</a></li>
  </ul>
</div>

    <h2>Feedback/Discuss</h2>
    <div class="contact">
  <ul>


    <li><a href="mailto:techtinkering@vlifesystems.com?subject=Comment:%20Setting%20up%20z80pack%20to%20Create%20an%20Emulated%20CP%2FM%20System&body=Article%20URL:%20https%3A%2F%2Ftechtinkering.com%2F2008%2F10%2F17%2Fsetting-up-z80pack-to-create-an-emulated-cpm-system%2F%0A" title="Send us an email">Email</a></li>
  </ul>
</div>
  </div>


    <div>
    <h2>Related Articles</h2>
    <div class="margin-buffer">
      <header>
  <h2><a href="/articles/transferring-files-to-and-from-cpm-d71-disk-images-using-ctools/">Transferring Files to and from CP/M .D71 Disk Images Using ctools</a></h2>
  <span class="post-meta">
      <ul class="tags">
          <li>#<a href="/articles/tag/cpm/">CP/M</a></li>
          <li>#<a href="/articles/tag/commodore/">Commodore</a></li>
          <li>#<a href="/articles/tag/emulation/">Emulation</a></li>
          <li>#<a href="/articles/tag/retro/">Retro</a></li>
      </ul>
  </span>
</header>
<div>
  Using Vice to emulate a Commodore 128 running CP/M works very well, but it isn't easy to get CP/M files directly onto and off a .D64/.D71 disk image.  The easiest way to do this under Linux is to use c...
  &nbsp;
  <a class="readMore" href="/articles/transferring-files-to-and-from-cpm-d71-disk-images-using-ctools/">Read More</a>
</div>
<br />
      <header>
  <h2><a href="/articles/emulating-a-cpm-system-with-z80pack/">Emulating a CP/M System With z80pack</a></h2>
  <span class="post-meta">
      <ul class="tags">
          <li>#<a href="/articles/tag/cpm/">CP/M</a></li>
          <li>#<a href="/articles/tag/emulation/">Emulation</a></li>
          <li>#<a href="/articles/tag/retro/">Retro</a></li>
      </ul>
  </span>
</header>
<div>
  z80pack is great for creating an emulated CP/M system.  It can either be used to create a general CP/M system or can emulate a specific system such as an IMSAI or ALTAIR including a graphical front-pan...
  &nbsp;
  <a class="readMore" href="/articles/emulating-a-cpm-system-with-z80pack/">Read More</a>
</div>
<br />
      <header>
  <h2><a href="/2008/10/22/installing-the-hi-tech-z80-c-compiler-for-cpm/">Installing the HI-TECH Z80 C Compiler for CP/M</a></h2>
  <span class="post-meta">
      <ul class="tags">
          <li>#<a href="/articles/tag/c/">C</a></li>
          <li>#<a href="/articles/tag/cpm/">CP/M</a></li>
          <li>#<a href="/articles/tag/programming/">Programming</a></li>
          <li>#<a href="/articles/tag/retro/">Retro</a></li>
          <li>#<a href="/articles/tag/z80/">Z80</a></li>
      </ul>
  </span>
</header>
<div>
  My language of choice is C and I am currently getting more involved with the CP/M operating system.  I have therefore decided that it would be nice to have a C compiler working under CP/M.  There are a...
  &nbsp;
  <a class="readMore" href="/2008/10/22/installing-the-hi-tech-z80-c-compiler-for-cpm/">Read More</a>
</div>
<br />
      <header>
  <h2><a href="/articles/breakout-style-games-on-cpm/">Breakout Style Games on CP/M</a></h2>
  <span class="post-meta">
      <ul class="tags">
          <li>#<a href="/articles/tag/cpm/">CP/M</a></li>
          <li>#<a href="/articles/tag/games/">Games</a></li>
          <li>#<a href="/articles/tag/retro/">Retro</a></li>
      </ul>
  </span>
</header>
<div>
  Breakout style video games were pretty popular at one time both at Arcades and on home computers.   The games are based on a simple concept where you have to destroy a group of 'bricks' at the top of t...
  &nbsp;
  <a class="readMore" href="/articles/breakout-style-games-on-cpm/">Read More</a>
</div>
<br />
      <header>
  <h2><a href="/articles/hamurabi-and-similar-games-on-cpm/">Hamurabi and Similar Games on CP/M</a></h2>
  <span class="post-meta">
      <ul class="tags">
          <li>#<a href="/articles/tag/cpm/">CP/M</a></li>
          <li>#<a href="/articles/tag/games/">Games</a></li>
          <li>#<a href="/articles/tag/retro/">Retro</a></li>
      </ul>
  </span>
</header>
<div>
  Hamurabi is probably the best known land and resource management game on CP/M.  However, there are a few other similar text-based games that sought to extend the concept such as Dukedom and Kingdom.  T...
  &nbsp;
  <a class="readMore" href="/articles/hamurabi-and-similar-games-on-cpm/">Read More</a>
</div>
<br />
</div>
    </div>

<script>
  if (isUserFromUK()) {
    document.write(amznBanner);
  }
</script>
    </div>

    <footer>
  <nav>
    <div class="container">
      <div>
        <script>
          if (isUserFromUK()) {
            document.write('<strong>Disclosure:<' +'/strong> As an Amazon Associate TechTinkering earns from qualifying purchases.<br />');
          }
        </script>
        <strong>Legal:</strong>
        <a href="/terms/">T & C</a>, <a href="/privacy/">Privacy Policy</a>
        &nbsp;
        <strong>Misc:</strong>
        <a href="https://github.com/lawrencewoodman/techtinkering.com" title="Fork TechTinkering On GitHub ">GitHub</a>
      </div>
    </div>
  </nav>
</footer>
  </body>
</html>