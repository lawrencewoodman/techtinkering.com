<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
  <title>Refactoring: Arm Yourself in the War Against Useless Comments</title>
  <meta name="description" content="Comments, comments, everywhere, but are they making your code clearer or just distracting you?  Comments are meant to be there to explain code and help you to un">
  <meta name="keywords" content="Retro Vintage Programming Tinkering"/>

  <!-- *** Twitter Card *** -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@techtinkering">
  <meta name="twitter:title" content="Refactoring: Arm Yourself in the War Against Useless Comments">
  <meta name="twitter:description" content="Comments, comments, everywhere, but are they making your code clearer or just distracting you?  Comments are meant to be there to explain code and help you to un">
  <!-- *** Twitter Card *** -->

  <!-- *** Open Graph *** --->
  <meta property="og:type" content="website">
  <meta property="og:title" content="Refactoring: Arm Yourself in the War Against Useless Comments">
  <meta property="og:description" content="Comments, comments, everywhere, but are they making your code clearer or just distracting you?  Comments are meant to be there to explain code and help you to un">
  <meta property="og:url" content="https://techtinkering.com/2012/04/26/refactoring-arm-yourself-in-the-war-against-useless-comments/">
  <!-- *** Open Graph *** --->

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-4388762-2"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-4388762-2');
  </script>

  <link href="/css/main.css" rel="stylesheet">
  <link href="/css/article.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" rel="stylesheet" type="text/css" />
  <link rel="canonical" href="https://techtinkering.com/2012/04/26/refactoring-arm-yourself-in-the-war-against-useless-comments/">
  <link rel="alternate" type="application/rss+xml" title="TechTinkering - Retro Computers, Programming, General Technical Tinkering"
        href="https://feedproxy.google.com/TechTinkering" />

	<!-- ****** faviconit.com favicons ****** -->
	<link rel="shortcut icon" href="/favicon.ico">
	<link rel="icon" sizes="16x16 32x32 64x64" href="/favicon.ico">
	<!-- ****** faviconit.com favicons ****** -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->

  <script>
    // Cookie Consent - https://cookieconsent.insites.com
    window.addEventListener("load", function(){
    window.cookieconsent.initialise({
      "palette": {
        "popup": {
          "background": "#252e39"
        },
        "button": {
          "background": "#14a7d0"
        }
      },
      "theme": "classic",
      "position": "top",
      "static": true,
      "content": {
        "message": "TechTinkering uses cookies for advertising, analytics, etc.",
        "href": "https://techtinkering.com/privacy/"
      }
    })});
  </script>

  <script>
    (adsbygoogle = window.adsbygoogle || []).push({
         google_ad_client: "ca-pub-1613732348909658",
         enable_page_level_ads: true
    });
  </script>
</head>
  <body>
    <nav>
  <div class="container">
    <div class="navbar-header">
      <a href="/">TechTinkering</a><br />
      =============
    </div>

    <div class="contact">
      <ul>
        <li>
          <a href="https://twitter.com/TechTinkering" title="@TechTinkering on Twitter">Twitter</a>
        </li>
        <li>
          <a href="https://youtube.com/techtinkering" title="TechTinkering's YouTube Channel">YouTube</a>
        </li>
        <li>
          <a href="https://feeds.feedburner.com/TechTinkering" title="Subscribe to our RSS Feed">RSS</a>
        </li>
        <li>
          <a href="mailto:techtinkering@vlifesystems.com" title="Email us, we'd love to hear from you">Email</a>
        </li>
        <li>
          <a href="/useful-links/" title="Useful vintage computer links">Useful Links</a>
        </li>
      </ul>
    </div>
  </div>
</nav>
    <div id="content" class="container">
      <div class="margin-buffer">
    <article itemscope itemtype="http://schema.org/BlogPosting">
      <header>
        <a href="/2012/04/26/refactoring-arm-yourself-in-the-war-against-useless-comments/" title="Refactoring: Arm Yourself in the War Against Useless Comments">
          <h1 itemprop="headline name">Refactoring: Arm Yourself in the War Against Useless Comments</h1>
        </a>
        <div>
            <time itemprop="datePublished"
                  datetime="2012-04-26">
              26 April 2012
            </time>
          <span itemscope itemprop="publisher"
                itemtype="http://schema.org/Organization">
            <meta itemprop="name" content="TechTinkering" />
            <meta itemprop="url" content="https://techtinkering.com" />
          </span>
          <span itemscope itemprop="author" itemtype="http://schema.org/Person">
            <a rel="author" itemprop="url" href="https://lawrencewoodman.github.io">
              <span itemprop="name">Lawrence Woodman</span>
            </a>
          </span>

          <ul class="tags">
              <li>#<a href="/articles/tag/programming/">Programming</a></li>
          </ul>
        </div>
      </header>
        <div itemprop="articleBody">
        <p>Comments, comments, everywhere, but are they making your code clearer or just distracting you?  Comments are meant to be there to explain code and help you to understand it.  However, they are often out of step and therefore can confuse. Think seriously before adding comments; it is often better to refactor the code so that it doesn't need so many comments.  Less is more as far as comments go.</p>
<h2>Superfluous Comments</h2>
<p>At one time most universities and colleges really pushed students to add comments to make their code clearer.  Unfortunately this often ended up with comments just reiterating what the code was doing, thereby breaking the <a href="http://en.wikipedia.org/wiki/Don%27t_repeat_yourself" title="Don't repeat yourself">DRY Principle</a>:</p>
<pre><code class="language-c">i = 0;    /* Initialize i */

/* Open file */
if ((fp = fopen(filename, &quot;r&quot;)) != NULL) {
  /* Read all the bytes until End-Of-File */
  while ((ch = fgetc(fp)) != EOF) {
    /* Output character */
    printf(&quot;%c&quot;, ch);
    i++;    /* Increment i */
  }
  /* Close file */
  fclose(fp);
}
</code></pre>
<p>I wish that I could say that this no longer happens, but some programmers seem to have trouble shaking off this <em>commenting for the sake of commenting</em> mind set.  I think that the code above is actually clearer without the comments:</p>
<pre><code class="language-c">i = 0;

if ((fp = fopen(filename, &quot;r&quot;)) != NULL) {
  while ((ch = fgetc(fp)) != EOF) {
    printf(&quot;%c&quot;, ch);
    i++;
  }
  fclose(fp);
}
</code></pre>
<h2>Comments Lie</h2>
<p>I have lost count of the number of times that I have seen comments express the exact opposite of the code.  Sure the following line from above was pointless:</p>
<pre><code class="language-c">i++;    /* Increment i */
</code></pre>
<p>But what about:</p>
<pre><code class="language-c">i--;    /* Increment i */
</code></pre>
<p>It is no wonder that this sort of thing happens; a large part of programming is trying things out to see what works.  You may have good intentions with your comments the first time you write something, but are you really going to change the comment each time your ideas change?  The main thing to remember is that <em>you will rarely read your own comments</em> and hence not realize when they are wrong.</p>
<h2>Refactor Rather Than Comment</h2>
<p>Comments should not be used as a crutch to support poor code.  Wherever possible make the code clear through good use of variable names and methods to describe use and intention.  Let the code explains itself.  Once you have clear code you can easily test it; something that you can't do with comments.</p>
<p>The following is inspired by code from <a href="http://lawrencewoodman.github.com/xAce/" title="A Jupiter Ace Emulator">xAce</a>.  It is not at all obvious what the code inside the function is doing, nor what is expected to be passed to <code>save_p()</code>.</p>
<pre><code class="language-c">bool
save_p(char *mem, int _de)
{
  const char end[] = {'.', 't', 'a', 'p', '\0'};
  char filename[15];
  char sum = 0;
  FILE *fp;
  int i;

  for (i = 0; !isspace(mem[i]) &amp;&amp; i &lt; 10; i++) {
    filename[i]=mem[i];
  }

  strcpy(filename+i, end);

  for (i = 0; i &lt; _de; i++) {
    sum ^= mem[i];
  }

  if ((fp = fopen(filename,&quot;wb&quot;)) != NULL) {
    fputc((_de)&amp;0xff,fp);
    fputc(((_de)&gt;&gt;8)&amp;0xff,fp);
    fwrite(mem,1,_de,fp);
    fputc(sum, _de), fp);
    fclose(fp);
  }

  return fp != NULL;
}
</code></pre>
<p>By moving some of the functionality into separate functions and renaming the variables and parameters it is much easier to see what is happening:</p>
<pre><code class="language-c">bool
save_program(char *program, int program_size)
{
  char filename[15];
  char checksum;
  FILE *fp;

  create_filename(filename, program);
  checksum = calc_checksum(program, program_size);

  if ((fp = fopen(filename,&quot;wb&quot;)) != NULL) {
    fputc( low_byte(program_size), fp);
    fputc( high_byte(program_size), fp);
    fwrite(program, sizeof(*program), program_size, fp);
    fputc(checksum, fp);
    fclose(fp);
  }

  return fp != NULL
}

static void
create_filename(char filename[15], char *program)
{
  const char filename_suffix[] = {'.', 't', 'a', 'p', '\0'};
  int i;

  for (i = 0; !isspace(program[i]) &amp;&amp; i &lt; 10; i++)
    filename[i] = program[i];

  strcpy(filename+i, filename_suffix);
}

static char
calc_checksum(char *data, int data_size)
{
  char checksum = 0;
  int i;

  for (i = 0; i &lt; data_size; i++)
    checksum ^= data[i];

  return checksum;
}

static unsigned char
low_byte(int word) { return(word &amp; 0xff); }

static unsigned char
high_byte(int word) { return(word &gt;&gt; 8); }
</code></pre>
<p>The code is a little longer, but ask yourself &quot;<em>Which code would you prefer to debug or modify?</em>&quot;  As far as what to refactor, this will come with experience and familiarity with the common idioms for the language that you are using.  There are a number of ways that the above could have been done, but this way worked for me.</p>
<h2>Consider Using Assertions Rather Than Comments</h2>
<p>The oft repeated reason for comments is to let people know what you can and can not pass to a function.  I like to try and keep everything in code.  To do this you can use assertions.  So in the <code>save_program()</code> example above, instead of using comments:</p>
<pre><code class="language-c">/* 0 &lt; program_size &lt;= 65535 */
bool
save_program(char *program, int program_size)
{
  char filename[15];
  char checksum;
</code></pre>
<p>Put this into the code using an assertion:</p>
<pre><code class="language-c">bool
save_program(char *program, int program_size)
{
  assert(program_size &gt; 0 &amp;&amp; program_size &lt;= 65535);

  char filename[15];
  char checksum;
</code></pre>
<p>Now the assertions can be tested and kept up-to-date.  Of course, assertions can be ugly if overused, so check the data at point of entry and after that trust that it is still correct.  It is worth noting that this is not an alternative to good api documentation, where comments definitely should be used.</p>
<h2>Won't All These Extra Methods Make it Slow?</h2>
<p>It depends on how you do it, modern compilers are pretty clever and you can often tell the compiler to inline methods if needed.  You may also want to consider wrapping some of the <code>assert()</code> statements so that they are only called when in <em>Debug</em> mode.  In general though, I find that the performance difference isn't noticeable, but the maintainability is increased dramatically.</p>
<h2>When Should I Use Comments?</h2>
<p>Comments are useful to say why you did something and to state requirements.  They are also great for documenting the api, particularly when they are meant to be parsed by external tools.  If you want other people to use your library, you have to reduce the barriers to their doing so.  Being able to quickly understand the api, will make it much more likely that it gets adopted.</p>
<p>In short: <em>Use comments for what you can't say in code</em>.</p>
      </div>
    </article>
</div>

  <div id="cclicence">
    <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
      <img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png" />
    </a>
    <br />
    <span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">Refactoring: Arm Yourself in the War Against Useless Comments</span>
    by <a xmlns:cc="http://creativecommons.org/ns#" href="https://techtinkering.com/2012/04/26/refactoring-arm-yourself-in-the-war-against-useless-comments/" property="cc:attributionName" rel="cc:attributionURL">Lawrence Woodman</a>
   is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
   
  </div>


  <div class="discuss">
    <h2 style="margin-top:0;">Share This Post</h2>
    <div class="contact">
  <ul>
    <li><a href="http://www.reddit.com/submit?url=https%3A%2F%2Ftechtinkering.com%2F2012%2F04%2F26%2Frefactoring-arm-yourself-in-the-war-against-useless-comments%2F&title=Refactoring%3A%20Arm%20Yourself%20in%20the%20War%20Against%20Useless%20Comments" target="_blank" title="Submit to Reddit">Reddit</a></li>
    <li><a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Ftechtinkering.com%2F2012%2F04%2F26%2Frefactoring-arm-yourself-in-the-war-against-useless-comments%2F&quote=Refactoring%3A%20Arm%20Yourself%20in%20the%20War%20Against%20Useless%20Comments" target="_blank" title="Share on Facebook">Facebook</a></li>
    <li><a href="https://twitter.com/intent/tweet?source=https%3A%2F%2Ftechtinkering.com%2F2012%2F04%2F26%2Frefactoring-arm-yourself-in-the-war-against-useless-comments%2F&text=Refactoring%3A%20Arm%20Yourself%20in%20the%20War%20Against%20Useless%20Comments:%0Ahttps%3A%2F%2Ftechtinkering.com%2F2012%2F04%2F26%2Frefactoring-arm-yourself-in-the-war-against-useless-comments%2F&via=TechTinkering" target="_blank" title="Tweet">Twitter</a></li>
    <li><a href="mailto:?subject=Refactoring%3A%20Arm%20Yourself%20in%20the%20War%20Against%20Useless%20Comments&body=Comments%2C%20comments%2C%20everywhere%2C%20but%20are%20they%20making%20your%20code%20clearer%20or%20just%20distracting%20you%3F%20%20Comments%20are%20meant%20to%20be%20there%20to%20explain%20code%20and%20help%20you%20to%20understand%20it.%20%20However%2C%20they%20are%20often%20ou...:%0A%0Ahttps%3A%2F%2Ftechtinkering.com%2F2012%2F04%2F26%2Frefactoring-arm-yourself-in-the-war-against-useless-comments%2F" target="_blank" title="Send email">Email</a></li>
  </ul>
</div>

    <h2>Feedback/Discuss</h2>
    <div class="contact">
  <ul>


    <li><a href="mailto:techtinkering@vlifesystems.com?subject=Comment:%20Refactoring%3A%20Arm%20Yourself%20in%20the%20War%20Against%20Useless%20Comments&body=Article%20URL:%20https%3A%2F%2Ftechtinkering.com%2F2012%2F04%2F26%2Frefactoring-arm-yourself-in-the-war-against-useless-comments%2F%0A" title="Send us an email">Email</a></li>
  </ul>
</div>
  </div>


    <div>
    <h2>Related Articles</h2>
    <div class="margin-buffer">
      <header>
  <h2><a href="/articles/getting-the-address-of-basic-variables-on-the-vic-20/">Getting the Address of BASIC Variables on the VIC-20</a></h2>
  <span class="post-meta">
      <ul class="tags">
          <li>#<a href="/articles/tag/assembly/">Assembly</a></li>
          <li>#<a href="/articles/tag/basic/">BASIC</a></li>
          <li>#<a href="/articles/tag/commodore/">Commodore</a></li>
          <li>#<a href="/articles/tag/programming/">Programming</a></li>
          <li>#<a href="/articles/tag/retro/">Retro</a></li>
          <li>#<a href="/articles/tag/vic-20/">VIC-20</a></li>
      </ul>
  </span>
</header>
<div>
  Getting the address of a BASIC variable can be useful if you want to pass data to a machine code routine or want to access the bytes of a variable directly to improve speed and reduce garbage collectio...
  &nbsp;
  <a class="readMore" href="/articles/getting-the-address-of-basic-variables-on-the-vic-20/">Read More</a>
</div>
<br />
      <header>
  <h2><a href="/articles/saving-and-loading-memory-on-the-vic-20/">Saving and Loading Memory on the VIC-20</a></h2>
  <span class="post-meta">
      <ul class="tags">
          <li>#<a href="/articles/tag/assembly/">Assembly</a></li>
          <li>#<a href="/articles/tag/basic/">BASIC</a></li>
          <li>#<a href="/articles/tag/commodore/">Commodore</a></li>
          <li>#<a href="/articles/tag/programming/">Programming</a></li>
          <li>#<a href="/articles/tag/retro/">Retro</a></li>
          <li>#<a href="/articles/tag/vic-20/">VIC-20</a></li>
      </ul>
  </span>
</header>
<div>
  Saving and loading memory is quite easy on the VIC-20 once you know how.  However, it isn't obvious how to do this and therefore this article will present a few simple ways of doing it from BASIC and A...
  &nbsp;
  <a class="readMore" href="/articles/saving-and-loading-memory-on-the-vic-20/">Read More</a>
</div>
<br />
      <header>
  <h2><a href="/articles/basic-line-storage-on-the-vic-20/">Basic Line Storage on the VIC-20</a></h2>
  <span class="post-meta">
      <ul class="tags">
          <li>#<a href="/articles/tag/basic/">BASIC</a></li>
          <li>#<a href="/articles/tag/commodore/">Commodore</a></li>
          <li>#<a href="/articles/tag/programming/">Programming</a></li>
          <li>#<a href="/articles/tag/retro/">Retro</a></li>
          <li>#<a href="/articles/tag/vic-20/">VIC-20</a></li>
      </ul>
  </span>
</header>
<div>
  BASIC programs are stored in memory using a simple structure that we can investigate and manipulate.  This article will show how they are stored and contains a BASIC program to go through each line of ...
  &nbsp;
  <a class="readMore" href="/articles/basic-line-storage-on-the-vic-20/">Read More</a>
</div>
<br />
      <header>
  <h2><a href="/articles/programming-in-assembly-with-vicmon-on-the-vic-20/">Programming in Assembly with VICMON on the VIC-20</a></h2>
  <span class="post-meta">
      <ul class="tags">
          <li>#<a href="/articles/tag/assembly/">Assembly</a></li>
          <li>#<a href="/articles/tag/commodore/">Commodore</a></li>
          <li>#<a href="/articles/tag/programming/">Programming</a></li>
          <li>#<a href="/articles/tag/retro/">Retro</a></li>
          <li>#<a href="/articles/tag/vic-20/">VIC-20</a></li>
      </ul>
  </span>
</header>
<div>
  VICMON is a machine language monitor released by Commodore in 1982 and is great for programming the VIC-20.  Its interactive nature means that it can often be quicker to develop via this rather than us...
  &nbsp;
  <a class="readMore" href="/articles/programming-in-assembly-with-vicmon-on-the-vic-20/">Read More</a>
</div>
<br />
      <header>
  <h2><a href="/articles/storing-machine-code-in-rem-statements-on-the-vic-20/">Storing Machine Code in REM Statements on the VIC-20</a></h2>
  <span class="post-meta">
      <ul class="tags">
          <li>#<a href="/articles/tag/assembly/">Assembly</a></li>
          <li>#<a href="/articles/tag/basic/">BASIC</a></li>
          <li>#<a href="/articles/tag/commodore/">Commodore</a></li>
          <li>#<a href="/articles/tag/programming/">Programming</a></li>
          <li>#<a href="/articles/tag/retro/">Retro</a></li>
          <li>#<a href="/articles/tag/vic-20/">VIC-20</a></li>
      </ul>
  </span>
</header>
<div>
  BASIC programs often contain machine code routines but they take up quite a lot of space in BASIC.  An interesting way to reduce the amount of space that they take is to store the machine code in REM s...
  &nbsp;
  <a class="readMore" href="/articles/storing-machine-code-in-rem-statements-on-the-vic-20/">Read More</a>
</div>
<br />
</div>
    </div>

    </div>

    <footer>
  <nav>
    <div class="container">
      <div>
        <strong>Legal:</strong>
        <a href="/terms/">T & C</a>, <a href="/privacy/">Privacy Policy</a>
        &nbsp;
        <strong>Misc:</strong>
        <a href="https://github.com/lawrencewoodman/techtinkering.com" title="Fork TechTinkering On GitHub ">GitHub</a>

      </div>
    </div>
  </nav>
</footer>
  </body>
</html>