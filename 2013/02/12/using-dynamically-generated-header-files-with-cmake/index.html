<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
  <title>Using Dynamically Generated Header Files with CMake</title>
  <meta name="description" content="Sometimes it can be useful to dynamically generate header files and include them from a C source file.  However, it can be a little difficult getting CMake to re">
  <meta name="keywords" content="Retro Vintage Programming Tinkering"/>

  <!-- *** Twitter Card *** -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@techtinkering">
  <meta name="twitter:title" content="Using Dynamically Generated Header Files with CMake">
  <meta name="twitter:description" content="Sometimes it can be useful to dynamically generate header files and include them from a C source file.  However, it can be a little difficult getting CMake to re">
  <!-- *** Twitter Card *** -->

  <!-- *** Open Graph *** --->
  <meta property="og:type" content="website">
  <meta property="og:title" content="Using Dynamically Generated Header Files with CMake">
  <meta property="og:description" content="Sometimes it can be useful to dynamically generate header files and include them from a C source file.  However, it can be a little difficult getting CMake to re">
  <meta property="og:url" content="https://techtinkering.com/2013/02/12/using-dynamically-generated-header-files-with-cmake/">
  <!-- *** Open Graph *** --->

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-4388762-2"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-4388762-2');
  </script>

  <link href="/css/main.css" rel="stylesheet">
  <link href="/css/article.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" rel="stylesheet" type="text/css" />
  <link rel="canonical" href="https://techtinkering.com/2013/02/12/using-dynamically-generated-header-files-with-cmake/">
  <link rel="alternate" type="application/rss+xml" title="TechTinkering - Retro Computers, Programming, General Technical Tinkering"
        href="https://feedproxy.google.com/TechTinkering" />

	<!-- ****** faviconit.com favicons ****** -->
	<link rel="shortcut icon" href="/favicon.ico">
	<link rel="icon" sizes="16x16 32x32 64x64" href="/favicon.ico">
	<!-- ****** faviconit.com favicons ****** -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->

  <script>
    // Cookie Consent - https://cookieconsent.insites.com
    window.addEventListener("load", function(){
    window.cookieconsent.initialise({
      "palette": {
        "popup": {
          "background": "#252e39"
        },
        "button": {
          "background": "#14a7d0"
        }
      },
      "theme": "classic",
      "position": "top",
      "static": true,
      "content": {
        "message": "TechTinkering uses cookies for advertising, analytics, etc.",
        "href": "https://techtinkering.com/privacy/"
      }
    })});
  </script>

  <script>
    (adsbygoogle = window.adsbygoogle || []).push({
         google_ad_client: "ca-pub-1613732348909658",
         enable_page_level_ads: true
    });
  </script>
</head>
  <body>
    <nav>
  <div class="container">
    <div class="navbar-header">
      <a href="/">TechTinkering</a><br />
      =============
    </div>

    <div class="contact">
      <ul>
        <li>
          <a href="https://twitter.com/TechTinkering" title="@TechTinkering on Twitter">Twitter</a>
        </li>
        <li>
          <a href="https://youtube.com/techtinkering" title="TechTinkering's YouTube Channel">YouTube</a>
        </li>
        <li>
          <a href="https://feeds.feedburner.com/TechTinkering" title="Subscribe to our RSS Feed">RSS</a>
        </li>
        <li>
          <a href="mailto:techtinkering@vlifesystems.com" title="Email us, we'd love to hear from you">Email</a>
        </li>
        <li>
          <a href="/useful-links/" title="Useful vintage computer links">Useful Links</a>
        </li>
      </ul>
    </div>
  </div>
</nav>
    <div id="content" class="container">
      <div class="margin-buffer">
    <article itemscope itemtype="http://schema.org/BlogPosting">
      <header>
        <a href="/2013/02/12/using-dynamically-generated-header-files-with-cmake/" title="Using Dynamically Generated Header Files with CMake">
          <h1 itemprop="headline name">Using Dynamically Generated Header Files with CMake</h1>
        </a>
        <div>
            <time itemprop="datePublished"
                  datetime="2013-02-12">
              12 February 2013
            </time>
          <span itemscope itemprop="publisher"
                itemtype="http://schema.org/Organization">
            <meta itemprop="name" content="TechTinkering" />
            <meta itemprop="url" content="https://techtinkering.com" />
          </span>
          <span itemscope itemprop="author" itemtype="http://schema.org/Person">
            <a rel="author" itemprop="url" href="https://lawrencewoodman.github.io">
              <span itemprop="name">Lawrence Woodman</span>
            </a>
          </span>

          <ul class="tags">
              <li>#<a href="/articles/tag/programming/">Programming</a></li>
          </ul>
        </div>
      </header>
        <div itemprop="articleBody">
        <p>Sometimes it can be useful to dynamically generate header files and include them from a C source file.  However, it can be a little difficult getting <a href="http://www.cmake.org">CMake</a> to recognize when to generate the files and when to recompile the source files that include those headers.  What follows is a method to do this.</p>
<h2>Telling CMake to Generate the Header File</h2>
<p>To generate the header file we need to create a <em>custom_command</em> which will run the command to generate the header file, when the file it is based on has changed. The following shows how to use the hypothetical <code>generatewordlistheader</code> command to create <code>wordlist.h</code> everytime <code>wordlist.txt</code> changes.</p>
<pre><code class="language-text">add_custom_command(
    PRE_BUILD
    OUTPUT wordlist.h
    COMMAND generatewordlistheader wordlist.txt wordlist.h
    DEPENDS wordlist.txt
)
</code></pre>
<h2>Telling CMake When to Recompile</h2>
<p>Next we need to tell CMake to recompile any source files which include the generated header file, when the header file has changed.  To do this we create a statically linked library, here called <code>poet</code>, that relies on the source files that include the header and the header itself.</p>
<pre><code class="language-text">add_library(poet STATIC poet.c ${MyApp_SOURCE_DIR}/src/wordlist.h)
</code></pre>
<p>Finally we need to ensure that the statically generated library above is linked into the application.</p>
<pre><code class="language-text">target_link_libraries(myapp poet)
</code></pre>
<h2>Full example</h2>
<p>Using a fictional project called <em>MyApp</em> we can see how this is put together.</p>
<pre><code class="language-text">cmake_minimum_required(VERSION 2.6)
project(MyApp)
add_executable(myapp myapp.c)

add_custom_command(
    PRE_BUILD
    OUTPUT wordlist.h
    COMMAND generatewordlistheader wordlist.txt wordlist.h
    DEPENDS wordlist.txt
)

add_library(poet STATIC poet.c ${MyApp_SOURCE_DIR}/src/wordlist.h)

target_link_libraries(myapp poet)
</code></pre>
<h2>Conclusion</h2>
<p>This isn't perfect but it does work.  Unfortunately CMake is an ugly, but very useful tool.  I'm sure there is a better way to do this and if anyone can think of a way, please leave a comment or email me.  Until then, this achieves what I and a number of other people have been trying to do.</p>
      </div>
    </article>
</div>

  <div id="cclicence">
    <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
      <img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png" />
    </a>
    <br />
    <span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">Using Dynamically Generated Header Files with CMake</span>
    by <a xmlns:cc="http://creativecommons.org/ns#" href="https://techtinkering.com/2013/02/12/using-dynamically-generated-header-files-with-cmake/" property="cc:attributionName" rel="cc:attributionURL">Lawrence Woodman</a>
   is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
   
  </div>


  <div class="discuss">
    <h2 style="margin-top:0;">Share This Post</h2>
    <div class="contact">
  <ul>
    <li><a href="http://www.reddit.com/submit?url=https%3A%2F%2Ftechtinkering.com%2F2013%2F02%2F12%2Fusing-dynamically-generated-header-files-with-cmake%2F&title=Using%20Dynamically%20Generated%20Header%20Files%20with%20CMake" target="_blank" title="Submit to Reddit">Reddit</a></li>
    <li><a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Ftechtinkering.com%2F2013%2F02%2F12%2Fusing-dynamically-generated-header-files-with-cmake%2F&quote=Using%20Dynamically%20Generated%20Header%20Files%20with%20CMake" target="_blank" title="Share on Facebook">Facebook</a></li>
    <li><a href="https://twitter.com/intent/tweet?source=https%3A%2F%2Ftechtinkering.com%2F2013%2F02%2F12%2Fusing-dynamically-generated-header-files-with-cmake%2F&text=Using%20Dynamically%20Generated%20Header%20Files%20with%20CMake:%0Ahttps%3A%2F%2Ftechtinkering.com%2F2013%2F02%2F12%2Fusing-dynamically-generated-header-files-with-cmake%2F&via=TechTinkering" target="_blank" title="Tweet">Twitter</a></li>
    <li><a href="mailto:?subject=Using%20Dynamically%20Generated%20Header%20Files%20with%20CMake&body=Sometimes%20it%20can%20be%20useful%20to%20dynamically%20generate%20header%20files%20and%20include%20them%20from%20a%20C%20source%20file.%20%20However%2C%20it%20can%20be%20a%20little%20difficult%20getting%20CMake%20to%20recognize%20when%20to%20generate%20the%20files%20and%20w...:%0A%0Ahttps%3A%2F%2Ftechtinkering.com%2F2013%2F02%2F12%2Fusing-dynamically-generated-header-files-with-cmake%2F" target="_blank" title="Send email">Email</a></li>
  </ul>
</div>

    <h2>Feedback/Discuss</h2>
    <div class="contact">
  <ul>


    <li><a href="mailto:techtinkering@vlifesystems.com?subject=Comment:%20Using%20Dynamically%20Generated%20Header%20Files%20with%20CMake&body=Article%20URL:%20https%3A%2F%2Ftechtinkering.com%2F2013%2F02%2F12%2Fusing-dynamically-generated-header-files-with-cmake%2F%0A" title="Send us an email">Email</a></li>
  </ul>
</div>
  </div>


    <div>
    <h2>Related Articles</h2>
    <div class="margin-buffer">
      <header>
  <h2><a href="/articles/80-columns-in-software-on-the-commodore-vic-20/">80 Columns in Software on the Commodore VIC-20</a></h2>
  <span class="post-meta">
      <ul class="tags">
          <li>#<a href="/articles/tag/commodore/">Commodore</a></li>
          <li>#<a href="/articles/tag/programming/">Programming</a></li>
          <li>#<a href="/articles/tag/retro/">Retro</a></li>
          <li>#<a href="/articles/tag/vic-20/">VIC-20</a></li>
      </ul>
  </span>
</header>
<div>
  If you have good eyesight, a well-tuned display and patience it is possible to use 80 columns in software on the VIC-20.  This is really just an experiment but considering the limitations of the Vic I ...
  &nbsp;
  <a class="readMore" href="/articles/80-columns-in-software-on-the-commodore-vic-20/">Read More</a>
</div>
<br />
      <header>
  <h2><a href="/articles/64-columns-sideways-on-the-commodore-vic-20/">64 Column Text Mode on the Commodore VIC-20</a></h2>
  <span class="post-meta">
      <ul class="tags">
          <li>#<a href="/articles/tag/commodore/">Commodore</a></li>
          <li>#<a href="/articles/tag/programming/">Programming</a></li>
          <li>#<a href="/articles/tag/retro/">Retro</a></li>
          <li>#<a href="/articles/tag/vic-20/">VIC-20</a></li>
      </ul>
  </span>
</header>
<div>
  With a little lateral thinking and by putting the television on its side we can create a 64 column sideways text mode on the VIC-20.  This article will demonstrate this and show how it is done.  Previo...
  &nbsp;
  <a class="readMore" href="/articles/64-columns-sideways-on-the-commodore-vic-20/">Read More</a>
</div>
<br />
      <header>
  <h2><a href="/articles/getting-the-address-of-basic-variables-on-the-vic-20/">Getting the Address of BASIC Variables on the VIC-20</a></h2>
  <span class="post-meta">
      <ul class="tags">
          <li>#<a href="/articles/tag/assembly/">Assembly</a></li>
          <li>#<a href="/articles/tag/basic/">BASIC</a></li>
          <li>#<a href="/articles/tag/commodore/">Commodore</a></li>
          <li>#<a href="/articles/tag/programming/">Programming</a></li>
          <li>#<a href="/articles/tag/retro/">Retro</a></li>
          <li>#<a href="/articles/tag/vic-20/">VIC-20</a></li>
      </ul>
  </span>
</header>
<div>
  Getting the address of a BASIC variable can be useful if you want to pass data to a machine code routine or want to access the bytes of a variable directly to improve speed and reduce garbage collectio...
  &nbsp;
  <a class="readMore" href="/articles/getting-the-address-of-basic-variables-on-the-vic-20/">Read More</a>
</div>
<br />
      <header>
  <h2><a href="/articles/saving-and-loading-memory-on-the-vic-20/">Saving and Loading Memory on the VIC-20</a></h2>
  <span class="post-meta">
      <ul class="tags">
          <li>#<a href="/articles/tag/assembly/">Assembly</a></li>
          <li>#<a href="/articles/tag/basic/">BASIC</a></li>
          <li>#<a href="/articles/tag/commodore/">Commodore</a></li>
          <li>#<a href="/articles/tag/programming/">Programming</a></li>
          <li>#<a href="/articles/tag/retro/">Retro</a></li>
          <li>#<a href="/articles/tag/vic-20/">VIC-20</a></li>
      </ul>
  </span>
</header>
<div>
  Saving and loading memory is quite easy on the VIC-20 once you know how.  However, it isn't obvious how to do this and therefore this article will present a few simple ways of doing it from BASIC and A...
  &nbsp;
  <a class="readMore" href="/articles/saving-and-loading-memory-on-the-vic-20/">Read More</a>
</div>
<br />
      <header>
  <h2><a href="/articles/basic-line-storage-on-the-vic-20/">Basic Line Storage on the VIC-20</a></h2>
  <span class="post-meta">
      <ul class="tags">
          <li>#<a href="/articles/tag/basic/">BASIC</a></li>
          <li>#<a href="/articles/tag/commodore/">Commodore</a></li>
          <li>#<a href="/articles/tag/programming/">Programming</a></li>
          <li>#<a href="/articles/tag/retro/">Retro</a></li>
          <li>#<a href="/articles/tag/vic-20/">VIC-20</a></li>
      </ul>
  </span>
</header>
<div>
  BASIC programs are stored in memory using a simple structure that we can investigate and manipulate.  This article will show how they are stored and contains a BASIC program to go through each line of ...
  &nbsp;
  <a class="readMore" href="/articles/basic-line-storage-on-the-vic-20/">Read More</a>
</div>
<br />
</div>
    </div>

    </div>

    <footer>
  <nav>
    <div class="container">
      <div>
        <strong>Legal:</strong>
        <a href="/terms/">T & C</a>, <a href="/privacy/">Privacy Policy</a>
        &nbsp;
        <strong>Misc:</strong>
        <a href="https://github.com/lawrencewoodman/techtinkering.com" title="Fork TechTinkering On GitHub ">GitHub</a>

      </div>
    </div>
  </nav>
</footer>
  </body>
</html>