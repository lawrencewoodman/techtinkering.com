<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
  <title>Improving the related_posts feature of jekyll</title>
  <meta name="description" content="Now that I have converted TechTinkering over to Jekyll, I have come up against a bit of a problem with site.related_posts: The results are always just the latest">
  <meta name="keywords" content="Retro Vintage Programming Tinkering"/>

  <!-- *** Twitter Card *** -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@techtinkering">
  <meta name="twitter:title" content="Improving the related_posts feature of jekyll">
  <meta name="twitter:description" content="Now that I have converted TechTinkering over to Jekyll, I have come up against a bit of a problem with site.related_posts: The results are always just the latest">
  <!-- *** Twitter Card *** -->

  <!-- *** Open Graph *** --->
  <meta property="og:type" content="website">
  <meta property="og:title" content="Improving the related_posts feature of jekyll">
  <meta property="og:description" content="Now that I have converted TechTinkering over to Jekyll, I have come up against a bit of a problem with site.related_posts: The results are always just the latest">
  <meta property="og:url" content="https://techtinkering.com/2011/08/17/improving-related-posts-on-jekyll/">
  <!-- *** Open Graph *** --->

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-4388762-2"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-4388762-2');
  </script>

  <script>
    function isUserFromUK() {
      return Intl.DateTimeFormat().resolvedOptions().timeZone != "Europe/London"
    }
  </script>

  <link href="/css/main.css" rel="stylesheet">
  <link href="/css/article.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" rel="stylesheet" type="text/css" />
  <link rel="canonical" href="https://techtinkering.com/2011/08/17/improving-related-posts-on-jekyll/">
  <link rel="alternate" type="application/rss+xml" title="TechTinkering - Retro Computers, Programming, General Technical Tinkering"
        href="https://feedproxy.google.com/TechTinkering" />

	<!-- ****** faviconit.com favicons ****** -->
	<link rel="shortcut icon" href="/favicon.ico">
	<link rel="icon" sizes="16x16 32x32 64x64" href="/favicon.ico">
	<!-- ****** faviconit.com favicons ****** -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>

  <script>
    if (isUserFromUK()) {
      console.log("No Google ADs - UK user");
    } else {
      console.log("Google ADs - not from uk");
      document.write('<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"><' + '/script>');
    }
  </script>

  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->

  <script>
    // Cookie Consent - https://cookieconsent.insites.com
    window.addEventListener("load", function(){
    window.cookieconsent.initialise({
      "palette": {
        "popup": {
          "background": "#252e39"
        },
        "button": {
          "background": "#14a7d0"
        }
      },
      "theme": "classic",
      "position": "top",
      "static": true,
      "content": {
        "message": "TechTinkering uses cookies for advertising, analytics, etc.",
        "href": "https://techtinkering.com/privacy/"
      }
    })});
  </script>

  <script>
    if (isUserFromUK()) {
      console.log("No Google Ads - uk user");
    } else {
      console.log("Google Ads - non-uk user");
      (adsbygoogle = window.adsbygoogle || []).push({
           google_ad_client: "ca-pub-1613732348909658",
           enable_page_level_ads: true
      });
    }
  </script>

  <script>
    if (isUserFromUK()) {
      console.log("Amazon Banner - from uk");
      // Amazon Prime Video Banner 728x90 and 300x250
      amznBanner='<div class="amazonBannerDesktop"><iframe src="https://rcm-eu.amazon-adsystem.com/e/cm?o=2&p=48&l=ur1&category=piv&banner=0E183RXMV88X6J8GJ002&f=ifr&linkID=a2c37aae0561f075af3356504493bdf0&t=techtinkering-21&tracking_id=techtinkering-21" width="728" height="90" scrolling="no" border="0" marginwidth="0" style="border:none;" frameborder="0" sandbox="allow-scripts allow-same-origin allow-popups allow-top-navigation-by-user-activation"><' + '/iframe><' +'/div><div class="amazonBannerMobile"><iframe src="https://rcm-eu.amazon-adsystem.com/e/cm?o=2&p=12&l=ur1&category=piv&banner=070GKT77WVHAHSRTHK02&f=ifr&linkID=0dc57b53bcc8f7ab67a385d51155e57a&t=techtinkering-21&tracking_id=techtinkering-21" width="300" height="250" scrolling="no" border="0" marginwidth="0" style="border:none;" frameborder="0" sandbox="allow-scripts allow-same-origin allow-popups allow-top-navigation-by-user-activation"><' + '/iframe><' + '/div>';
    }
  </script>
</head>
  <body>
    <nav>
  <div class="container">
    <div class="navbar-header">
      <a href="/">TechTinkering</a><br />
      =============
    </div>

    <div class="contact">
      <ul>
        <li>
          <a href="https://twitter.com/TechTinkering" title="@TechTinkering on Twitter">Twitter</a>
        </li>
        <li>
          <a href="https://youtube.com/techtinkering" title="TechTinkering's YouTube Channel">YouTube</a>
        </li>
        <li>
          <a href="https://feeds.feedburner.com/TechTinkering" title="Subscribe to our RSS Feed">RSS</a>
        </li>
        <li>
          <a href="mailto:techtinkering@vlifesystems.com" title="Email us, we'd love to hear from you">Email</a>
        </li>
        <li>
          <a href="/useful-links/" title="Useful vintage computer links">Useful Links</a>
        </li>
      </ul>
    </div>
  </div>
</nav>
    <div id="content" class="container">
      <div class="margin-buffer">
    <article itemscope itemtype="http://schema.org/BlogPosting">
      <header>
        <a href="/2011/08/17/improving-related-posts-on-jekyll/" title="Improving the related_posts feature of jekyll">
          <h1 itemprop="headline name">Improving the related_posts feature of jekyll</h1>
        </a>
        <div>
            <time itemprop="datePublished"
                  datetime="2011-08-17">
              17 August 2011
            </time>
          <span itemscope itemprop="publisher"
                itemtype="http://schema.org/Organization">
            <meta itemprop="name" content="TechTinkering" />
            <meta itemprop="url" content="https://techtinkering.com" />
          </span>
          <span itemscope itemprop="author" itemtype="http://schema.org/Person">
            <a rel="author" itemprop="url" href="https://lawrencewoodman.github.io">
              <span itemprop="name">Lawrence Woodman</span>
            </a>
          </span>

          <ul class="tags">
              <li>#<a href="/articles/tag/jekyll/">Jekyll</a></li>
              <li>#<a href="/articles/tag/ruby/">Ruby</a></li>
              <li>#<a href="/articles/tag/webdevelopment/">Web Development</a></li>
          </ul>
        </div>
      </header>
        <div itemprop="articleBody">
        <p>Now that I have converted TechTinkering over to <a href="http://jekyllrb.com/">Jekyll</a>, I have come up against a bit of a problem with <code>site.related_posts</code>: The results are always just the latest posts, and are not filtered or ordered for relevance.  I see that lots of people are struggling with a similar problem and have therefore decided to write a plugin which will improve it.  Because the posts on this site make use of <em>tags</em>, I decided to match against those to assess relevance.</p>
<h2>The Code</h2>
<p>I was in two minds as to how to structure this plugin: whether to write a straight monkey patch, or whether to put it in a module and include it.  I went with the latter as I have heard a lot of talk about this being the preferred route to ease debugging.  However it doesn't seem quite right because I have had to force the removal of the old <code>related_posts</code> method to do so.  If anyone has any suggestions on this, then please leave a comment here or via the <a href="https://github.com/LawrenceWoodman/related_posts-jekyll_plugin">GitHub repo</a>.</p>
<p>At the time of writing, the <code>related_posts.rb</code> plugin file looks like this:</p>
<pre><code class="language-ruby">require 'jekyll/post'

module RelatedPosts

  # Used to remove #related_posts so that it can be overridden
  def self.included(klass)
    klass.class_eval do
      remove_method :related_posts
    end
  end

  # Calculate related posts.
  #
  # Returns [&lt;Post&gt;]
  def related_posts(posts)
    return [] unless posts.size &gt; 1
    highest_freq = Jekyll::Post.tag_freq(posts).values.max
    related_scores = Hash.new(0)
    posts.each do |post|
      post.tags.each do |tag|
        if self.tags.include?(tag) &amp;&amp; post != self
          cat_freq = Jekyll::Post.tag_freq(posts)[tag]
          related_scores[post] += (1+highest_freq-cat_freq)
        end
      end
    end

    Jekyll::Post.sort_related_posts(related_scores)
  end

  module ClassMethods
    # Calculate the frequency of each tag.
    #
    # Returns {tag =&gt; freq, tag =&gt; freq, ...}
    def tag_freq(posts)
      return @tag_freq if @tag_freq
      @tag_freq = Hash.new(0)
      posts.each do |post|
        post.tags.each {|tag| @tag_freq[tag] += 1}
      end
      @tag_freq
    end

    # Sort the related posts in order of their score and date
    # and return just the posts
    def sort_related_posts(related_scores)
      related_scores.sort do |a,b|
        if a[1] &lt; b[1]
          1
        elsif a[1] &gt; b[1]
          -1
        else
          b[0].date &lt;=&gt; a[0].date
        end
      end.collect {|post,freq| post}
    end
  end

end

module Jekyll
  class Post
    include RelatedPosts
    extend RelatedPosts::ClassMethods
  end
end
</code></pre>
<h2>Installation</h2>
<p><em>Please look at the <a href="https://github.com/LawrenceWoodman/related_posts-jekyll_plugin/blob/master/README.rdoc">README</a> file for the latest instructions.</em></p>
<ol>
<li>Download the latest version of the plugin from the <a href="https://github.com/LawrenceWoodman/related_posts-jekyll_plugin">related_posts-jekyll_plugin</a> repository</li>
<li>Copy <code>related_posts.rb</code> to your <code>_plugins</code> directory</li>
</ol>
<h2>Using <code>site.related_posts</code></h2>
<p>The plugin replaces the functionality of <code>site.related_posts</code> so you
can use it as follows:</p>
<pre><code class="language-html">{% for post in site.related_posts %}
  &lt;a href=&quot;{{ post.url }}&quot;&gt;{{ post.title }}&lt;/a&gt;&lt;br /&gt;
{% endfor %}
</code></pre>
      </div>
    </article>
</div>

<script>
  if (isUserFromUK()) {
    document.write(amznBanner);
  }
</script>

  <div id="cclicence">
    <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
      <img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png" />
    </a>
    <br />
    <span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">Improving the related_posts feature of jekyll</span>
    by <a xmlns:cc="http://creativecommons.org/ns#" href="https://techtinkering.com/2011/08/17/improving-related-posts-on-jekyll/" property="cc:attributionName" rel="cc:attributionURL">Lawrence Woodman</a>
   is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
   
  </div>


  <div class="discuss">
    <h2 style="margin-top:0;">Share This Post</h2>
    <div class="contact">
  <ul>
    <li><a href="http://www.reddit.com/submit?url=https%3A%2F%2Ftechtinkering.com%2F2011%2F08%2F17%2Fimproving-related-posts-on-jekyll%2F&title=Improving%20the%20related_posts%20feature%20of%20jekyll" target="_blank" title="Submit to Reddit">Reddit</a></li>
    <li><a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Ftechtinkering.com%2F2011%2F08%2F17%2Fimproving-related-posts-on-jekyll%2F&quote=Improving%20the%20related_posts%20feature%20of%20jekyll" target="_blank" title="Share on Facebook">Facebook</a></li>
    <li><a href="https://twitter.com/intent/tweet?source=https%3A%2F%2Ftechtinkering.com%2F2011%2F08%2F17%2Fimproving-related-posts-on-jekyll%2F&text=Improving%20the%20related_posts%20feature%20of%20jekyll:%0Ahttps%3A%2F%2Ftechtinkering.com%2F2011%2F08%2F17%2Fimproving-related-posts-on-jekyll%2F&via=TechTinkering" target="_blank" title="Tweet">Twitter</a></li>
    <li><a href="mailto:?subject=Improving%20the%20related_posts%20feature%20of%20jekyll&body=Now%20that%20I%20have%20converted%20TechTinkering%20over%20to%20Jekyll%2C%20I%20have%20come%20up%20against%20a%20bit%20of%20a%20problem%20with%20site.related_posts%3A%20The%20results%20are%20always%20just%20the%20latest%20posts%2C%20and%20are%20not%20filtered%20or%20ordered%20...:%0A%0Ahttps%3A%2F%2Ftechtinkering.com%2F2011%2F08%2F17%2Fimproving-related-posts-on-jekyll%2F" target="_blank" title="Send email">Email</a></li>
  </ul>
</div>

    <h2>Feedback/Discuss</h2>
    <div class="contact">
  <ul>


    <li><a href="mailto:techtinkering@vlifesystems.com?subject=Comment:%20Improving%20the%20related_posts%20feature%20of%20jekyll&body=Article%20URL:%20https%3A%2F%2Ftechtinkering.com%2F2011%2F08%2F17%2Fimproving-related-posts-on-jekyll%2F%0A" title="Send us an email">Email</a></li>
  </ul>
</div>
  </div>


    <div>
    <h2>Related Articles</h2>
    <div class="margin-buffer">
      <header>
  <h2><a href="/2011/02/15/a-jekyll-plugin-to-display-ratings-as-star-images/">A Jekyll Plugin to Display Ratings as Star Images</a></h2>
  <span class="post-meta">
      <ul class="tags">
          <li>#<a href="/articles/tag/jekyll/">Jekyll</a></li>
          <li>#<a href="/articles/tag/liquid/">Liquid</a></li>
          <li>#<a href="/articles/tag/ruby/">Ruby</a></li>
          <li>#<a href="/articles/tag/webdevelopment/">Web Development</a></li>
      </ul>
  </span>
</header>
<div>
  I have been using Jekyll a lot recently on the Trust a Friend website and found the need to display a rating as a series of stars.  Initially I implemented this in JavaScript, which worked fine, but I ...
  &nbsp;
  <a class="readMore" href="/2011/02/15/a-jekyll-plugin-to-display-ratings-as-star-images/">Read More</a>
</div>
<br />
      <header>
  <h2><a href="/2011/09/08/pisceans-and-october-babies-more-likely-to-become-poets/">Pisceans and October Babies More Likely to Become Poets.  Scraping Wikipedia Reveals All</a></h2>
  <span class="post-meta">
      <ul class="tags">
          <li>#<a href="/articles/tag/javascript/">JavaScript</a></li>
          <li>#<a href="/articles/tag/ruby/">Ruby</a></li>
          <li>#<a href="/articles/tag/webscraping/">Web Scraping</a></li>
      </ul>
  </span>
</header>
<div>
  This is the second in a series of articles looking into whether when you were born affects your future.  In the previous article I looked at Nobel laureates, which are, of course, from a range of field...
  &nbsp;
  <a class="readMore" href="/2011/09/08/pisceans-and-october-babies-more-likely-to-become-poets/">Read More</a>
</div>
<br />
      <header>
  <h2><a href="/2011/08/24/does-when-you-were-born-affect-your-chance-of-becoming-a-nobel-laureate/">Does When You Were Born Affect Your Chance of Becoming a Nobel Laureate? Scraping Wikipedia to Find Out</a></h2>
  <span class="post-meta">
      <ul class="tags">
          <li>#<a href="/articles/tag/ruby/">Ruby</a></li>
          <li>#<a href="/articles/tag/webscraping/">Web Scraping</a></li>
      </ul>
  </span>
</header>
<div>
  There has been a lot of talk in the UK recently about whether when you were born affects your schooling.  Lots of teachers have noticed how pupils born at the end of the Summer often struggle compared ...
  &nbsp;
  <a class="readMore" href="/2011/08/24/does-when-you-were-born-affect-your-chance-of-becoming-a-nobel-laureate/">Read More</a>
</div>
<br />
      <header>
  <h2><a href="/2011/04/16/mida-a-microdata-parser-extractor-library-for-ruby/">Mida - A Microdata parser/extractor library for Ruby</a></h2>
  <span class="post-meta">
      <ul class="tags">
          <li>#<a href="/articles/tag/library/">Library</a></li>
          <li>#<a href="/articles/tag/microdata/">Microdata</a></li>
          <li>#<a href="/articles/tag/ruby/">Ruby</a></li>
      </ul>
  </span>
</header>
<div>
  I have recently released Mida as a Gem for parsing/extracting Microdata from web pages.  Not many sites at the moment are using Microdata, in fact, apart from this site, I only know of one other: Trust...
  &nbsp;
  <a class="readMore" href="/2011/04/16/mida-a-microdata-parser-extractor-library-for-ruby/">Read More</a>
</div>
<br />
      <header>
  <h2><a href="/2008/09/16/how-to-share-an-ssl-certificate-and-still-use-cookies/">How to share an SSL certificate and still use cookies</a></h2>
  <span class="post-meta">
      <ul class="tags">
          <li>#<a href="/articles/tag/php/">PHP</a></li>
          <li>#<a href="/articles/tag/programming/">Programming</a></li>
          <li>#<a href="/articles/tag/ssl/">SSL</a></li>
          <li>#<a href="/articles/tag/security/">Security</a></li>
          <li>#<a href="/articles/tag/webdevelopment/">Web Development</a></li>
      </ul>
  </span>
</header>
<div>
  Website hosting companies often provide a shared SSL certificate, but this presents the web designer with the problem of how to use it for a site that uses cookies.  I have read many people say that th...
  &nbsp;
  <a class="readMore" href="/2008/09/16/how-to-share-an-ssl-certificate-and-still-use-cookies/">Read More</a>
</div>
<br />
</div>
    </div>

<script>
  if (isUserFromUK()) {
    document.write(amznBanner);
  }
</script>

    </div>

    <footer>
  <nav>
    <div class="container">
      <div>
        <script>
          if (isUserFromUK()) {
            document.write('<strong>Disclosure:<' +'/strong> As an Amazon Associate TechTinkering earns from qualifying purchases.<br />');
          }
        </script>
        <strong>Legal:</strong>
        <a href="/terms/">T & C</a>, <a href="/privacy/">Privacy Policy</a>
        &nbsp;
        <strong>Misc:</strong>
        <a href="https://github.com/lawrencewoodman/techtinkering.com" title="Fork TechTinkering On GitHub ">GitHub</a>
      </div>
    </div>
  </nav>
</footer>
  </body>
</html>