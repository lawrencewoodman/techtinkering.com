<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
  <title>Creating a TTY Simulator in Assembly Language on the VIC-20</title>
  <meta name="description" content="The Vicmon machine language cartridge is an excellent tool for exploring the Vic-20.  This article and its associated video will show you how to use it to create">
  <meta name="keywords" content="Retro Vintage Programming Tinkering"/>

  <!-- *** Twitter Card *** -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@techtinkering">
  <meta name="twitter:title" content="Creating a TTY Simulator in Assembly Language on the VIC-20">
  <meta name="twitter:description" content="The Vicmon machine language cartridge is an excellent tool for exploring the Vic-20.  This article and its associated video will show you how to use it to create">
  <!-- *** Twitter Card *** -->

  <!-- *** Open Graph *** --->
  <meta property="og:type" content="website">
  <meta property="og:title" content="Creating a TTY Simulator in Assembly Language on the VIC-20">
  <meta property="og:description" content="The Vicmon machine language cartridge is an excellent tool for exploring the Vic-20.  This article and its associated video will show you how to use it to create">
  <meta property="og:url" content="https://techtinkering.com/2013/05/04/creating-a-tty-simulator-in-assembly-language-on-the-vic-20/">
  <!-- *** Open Graph *** --->

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-4388762-2"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-4388762-2');
  </script>

  <script>
    console.log('timeZone: '+Intl.DateTimeFormat().resolvedOptions().timeZone);
    function isUserFromUK() {
      return Intl.DateTimeFormat().resolvedOptions().timeZone == "Europe/London";
    }
  </script>

  <link href="/css/main.css" rel="stylesheet">
  <link href="/css/article.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" rel="stylesheet" type="text/css" />
  <link rel="canonical" href="https://techtinkering.com/2013/05/04/creating-a-tty-simulator-in-assembly-language-on-the-vic-20/">
  <link rel="alternate" type="application/rss+xml" title="TechTinkering - Retro Computers, Programming, General Technical Tinkering"
        href="https://feedproxy.google.com/TechTinkering" />

	<!-- ****** faviconit.com favicons ****** -->
	<link rel="shortcut icon" href="/favicon.ico">
	<link rel="icon" sizes="16x16 32x32 64x64" href="/favicon.ico">
	<!-- ****** faviconit.com favicons ****** -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>

  <script>
    if (isUserFromUK()) {
      console.log("No Google ADs - UK user");
    } else {
      console.log("Google ADs - not from uk");
      document.write('<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"><' + '/script>');
    }
  </script>

  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->

  <script>
    // Cookie Consent - https://cookieconsent.insites.com
    window.addEventListener("load", function(){
    window.cookieconsent.initialise({
      "palette": {
        "popup": {
          "background": "#252e39"
        },
        "button": {
          "background": "#14a7d0"
        }
      },
      "theme": "classic",
      "position": "top",
      "static": true,
      "content": {
        "message": "TechTinkering uses cookies for advertising, analytics, etc.",
        "href": "https://techtinkering.com/privacy/"
      }
    })});
  </script>

  <script>
    if (isUserFromUK()) {
      console.log("No Google Ads - uk user");
    } else {
      console.log("Google Ads - non-uk user");
      (adsbygoogle = window.adsbygoogle || []).push({
           google_ad_client: "ca-pub-1613732348909658",
           enable_page_level_ads: true
      });
    }
  </script>

  <script>
    if (isUserFromUK()) {
      console.log("Amazon Banner - from uk");
      // Amazon Prime Video Banner 728x90 and 300x250
      amznBanner='<div class="amazonBannerDesktop"><iframe src="https://rcm-eu.amazon-adsystem.com/e/cm?o=2&p=48&l=ur1&category=piv&banner=0E183RXMV88X6J8GJ002&f=ifr&linkID=a2c37aae0561f075af3356504493bdf0&t=techtinkering-21&tracking_id=techtinkering-21" width="728" height="90" scrolling="no" border="0" marginwidth="0" style="border:none;" frameborder="0" sandbox="allow-scripts allow-same-origin allow-popups allow-top-navigation-by-user-activation"><' + '/iframe><' +'/div><div class="amazonBannerMobile"><iframe src="https://rcm-eu.amazon-adsystem.com/e/cm?o=2&p=12&l=ur1&category=piv&banner=070GKT77WVHAHSRTHK02&f=ifr&linkID=0dc57b53bcc8f7ab67a385d51155e57a&t=techtinkering-21&tracking_id=techtinkering-21" width="300" height="250" scrolling="no" border="0" marginwidth="0" style="border:none;" frameborder="0" sandbox="allow-scripts allow-same-origin allow-popups allow-top-navigation-by-user-activation"><' + '/iframe><' + '/div>';
    }
  </script>
</head>
  <body>
    <nav>
  <div class="container">
    <div class="navbar-header">
      <a href="/">TechTinkering</a><br />
      =============
    </div>

    <div class="contact">
      <ul>
        <li>
          <a href="https://twitter.com/TechTinkering" title="@TechTinkering on Twitter">Twitter</a>
        </li>
        <li>
          <a href="https://youtube.com/techtinkering" title="TechTinkering's YouTube Channel">YouTube</a>
        </li>
        <li>
          <a href="https://feeds.feedburner.com/TechTinkering" title="Subscribe to our RSS Feed">RSS</a>
        </li>
        <li>
          <a href="mailto:techtinkering@vlifesystems.com" title="Email us, we'd love to hear from you">Email</a>
        </li>
        <li>
          <a href="/useful-links/" title="Useful vintage computer links">Useful Links</a>
        </li>
      </ul>
    </div>
  </div>
</nav>
    <div id="content" class="container">
      <div class="margin-buffer">
    <article itemscope itemtype="http://schema.org/BlogPosting">
      <header>
        <a href="/2013/05/04/creating-a-tty-simulator-in-assembly-language-on-the-vic-20/" title="Creating a TTY Simulator in Assembly Language on the VIC-20">
          <h1 itemprop="headline name">Creating a TTY Simulator in Assembly Language on the VIC-20</h1>
        </a>
        <div>
            <time itemprop="datePublished"
                  datetime="2013-05-04">
               4 May 2013
            </time>
          <span itemscope itemprop="publisher"
                itemtype="http://schema.org/Organization">
            <meta itemprop="name" content="TechTinkering" />
            <meta itemprop="url" content="https://techtinkering.com" />
          </span>
          <span itemscope itemprop="author" itemtype="http://schema.org/Person">
            <a rel="author" itemprop="url" href="https://lawrencewoodman.github.io">
              <span itemprop="name">Lawrence Woodman</span>
            </a>
          </span>

          <ul class="tags">
              <li>#<a href="/articles/tag/assembly/">Assembly</a></li>
              <li>#<a href="/articles/tag/commodore/">Commodore</a></li>
              <li>#<a href="/articles/tag/programming/">Programming</a></li>
              <li>#<a href="/articles/tag/retro/">Retro</a></li>
              <li>#<a href="/articles/tag/vic-20/">VIC-20</a></li>
          </ul>
        </div>
      </header>
        <div itemprop="articleBody">
        <p>The Vicmon machine language cartridge is an excellent tool for exploring the Vic-20.  This article and its associated video will show you how to use it to create a simple program that will change the normal output of a Vic so that it feels a bit like a teletype terminal.  This will be done by taking over some of the functionality of the KERNEL's <em>CHROUT</em> subroutine at <code>$FFD2</code>.  For those without an easy way of entering an assembly language program, there is a BASIC listing at the end.</p>
<p>Assuming you have the Vicmon cartridge attached to your machine or emulator, you can now enter the monitor.  If you are not too familiar with the Vicmon cartridge, have a look at: <a href="/2013/04/16/beginning-assembly-programming-on-the-commodore-vic-20/">Beginning Assembly Programming on the Vic-20</a>.</p>
<pre><code class="language-basic">SYS 24576
</code></pre>
<p>Each KERNAL subroutine is actually just a jump table to somewhere else.  To see where the <em>CHROUT</em> subroutine jumps to, we'll disassemble the code at <code>$FFD2</code>:</p>
<pre><code class="language-text">.D FFD2
</code></pre>
<p>Which shows that it contains:</p>
<pre><code class="language-text">FFD2 JMP ($0326)
</code></pre>
<p>This is an indirect jump to the address stored at <code>$0326</code>.</p>
<p>If we now look at <code>$0326</code>:</p>
<pre><code class="language-text">.M 0326
</code></pre>
<p>We see that the first two bytes are <code>7A F2</code>.  The 6502 is little-endian, so it stores the least significant byte first and hence this is address <code>$F27A</code>.  Because <code>$0326</code> is in RAM, we can change the address there to point to our code.  Once our routine has been run, we'll jump to <code>$F27A</code> to output the character to screen.</p>
<p>It would be better if our program doesn't interfere with BASIC, so as it is quite small, we can store it in the cassette buffer.  This is located at <code>$033C</code> and is 191 bytes long.  If you load or save with the cassette, the program will naturally be lost.</p>
<p>The program is essentially in two parts.  The first part changes the output vector to point to the second part and sets the volume to maximum.  The second part is the routine which will be called when the <em>CHROUT</em> (<code>$FFD2</code>) subroutine jumps to the output vector stored at <code>$0326</code>.  This part will output a noise, pause and then jump to the original output vector at <code>$F27A</code>.</p>
<p>The video below shows how to use the Vicmon machine language cartridge to enter the program and demonstrates the TTY effect.</p>
<div class="youtube-wrapper">
  <iframe width="560" height="315" src="https://www.youtube.com/embed/kmvF85euefs" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</div>
<h2>Disassembly of Program</h2>
<p>Here is the full program as entered in the video, so that you can play with it yourself.</p>
<pre><code class="language-text">      ; Initialize the routine
033C  LDA #$03      ; Point output vector used by $FFD2 to our routine
033E  STA $0327     ; |
0341  LDA #$4C      ; |
0343  STA $0326     ; \
0346  LDA #$0F      ; Set the volume to maximum
0348  STA $900E     ; \
034B  RTS

      ; The main routine pointed to by the output vector
034C  PHA           ; Save the character to be printed

034D  CMP #$20      ; Skip making a noise if a space character
034F  BEQ $035A     ; \
0351  CMP #$0D      ; Skip making a noise if a return character
0353  BEQ $035A     ; \

0355  LDA #$80      ; Make the lowest note possible with speaker 2
0357  STA $900B     ; \

035A  TXA           ; Save the registers because $FFD2 doesn't alter them
035B  PHA           ; |
035C  TYA           ; |
035D  PHA           ; \

035E  LDY #$00      ; Delay to hold note if making a noise or give equal gap
0360  LDX #$15      ; |
0362  DEY           ; |
0363  BNE $0362     ; |
0365  DEX           ; |
0366  BNE $0362     ; \

0368  LDA #$00      ; Turn off speaker 2
036A  STA $900B     ; \

036D  LDY #$00      ; Delay between letters
036F  LDX #$10      ; |
0371  DEY           ; |
0372  BNE $0371     ; |
0374  DEX           ; |
0375  BNE $0371     ; \

0377  PLA           ; Restore the registers
0378  TAY           ; |
0379  PLA           ; |
037A  TAX           ; |
037B  PLA           ; \

037C  JMP $F27A     ; Jump to the normal output vector stored in $0326
</code></pre>
<h2>Memory Dump</h2>
<p>Below is a memory dump of the program.  Some find it quicker to enter the hex codes directly and this is also useful to create a BASIC program that will load the machine language.</p>
<pre><code class="language-text">033C  A9 03 8D 27 03
0341  A9 4C 8D 26 03
0346  A9 0F 8D 0E 90
034B  60 48 C9 20 F0
0350  09 C9 0D F0 05
0355  A9 80 8D 0B 90
035A  8A 48 98 48 A0
035F  00 A2 15 88 D0
0364  FD CA D0 FA A9
0369  00 8D 0B 90 A0
036E  00 A2 10 88 D0
0373  FD CA D0 FA 68
0378  A8 68 AA 68 4C
037D  7A F2
</code></pre>
<p>I find it quite nice to work with the hex as well as assembly language, particularly when you are debugging as it can be quicker to navigate and find what you are looking for.  Here you can see the repeated <code>LDA</code> commands used at the start of the program as <code>A9</code>.  You can also see the <code>20</code> used to detect a space at <code>$034E</code>.  If you wanted to change this character, you could just alter that memory location, instead of reassembling the line.</p>
<h2>BASIC Alternative</h2>
<p>The following is the program converted to BASIC so that anyone with a Vic can enter it.</p>
<pre><code class="language-basic">10 FOR ADR=828 TO 894:READ OCT:POKE ADR,OCT:NEXT ADR
20 DATA 169,3,141,39,3,169,76,141,38,3
30 DATA 169,15,141,14,144,96,72,201,32,240
40 DATA 9,201,13,240,5,169,128,141,11,144
50 DATA 138,72,152,72,160,0,162,21,136,208
60 DATA 253,202,208,250,169,0,141,11,144,160
70 DATA 0,162,16,136,208,253,202,208,250,104
80 DATA 168,104,170,104,76,122,242
90 SYS 828
</code></pre>
<p>All you have to do is <code>RUN</code> the program and from that point on your Vic will feel a bit like a TTY.</p>
<h2>Where now?</h2>
<p>For more information on Vicmon or for those just starting to program the Vic-20 in assembly language, take a look at: <a href="/2013/04/16/beginning-assembly-programming-on-the-commodore-vic-20/">Beginning Assembly Programming on the Vic-20</a>.  I have also created an extended version of the TTY simulator and hosted it on GitHub: <a href="https://github.com/LawrenceWoodman/vic20_simtty">vic20_simtty</a>.</p>
      </div>
    </article>
</div>

<script>
  if (isUserFromUK()) {
    document.write(amznBanner);
  }
</script>

  <div id="cclicence">
    <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
      <img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png" />
    </a>
    <br />
    <span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">Creating a TTY Simulator in Assembly Language on the VIC-20</span>
    by <a xmlns:cc="http://creativecommons.org/ns#" href="https://techtinkering.com/2013/05/04/creating-a-tty-simulator-in-assembly-language-on-the-vic-20/" property="cc:attributionName" rel="cc:attributionURL">Lawrence Woodman</a>
   is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
   
  </div>


  <div class="discuss">
    <h2 style="margin-top:0;">Share This Post</h2>
    <div class="contact">
  <ul>
    <li><a href="http://www.reddit.com/submit?url=https%3A%2F%2Ftechtinkering.com%2F2013%2F05%2F04%2Fcreating-a-tty-simulator-in-assembly-language-on-the-vic-20%2F&title=Creating%20a%20TTY%20Simulator%20in%20Assembly%20Language%20on%20the%20VIC-20" target="_blank" title="Submit to Reddit">Reddit</a></li>
    <li><a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Ftechtinkering.com%2F2013%2F05%2F04%2Fcreating-a-tty-simulator-in-assembly-language-on-the-vic-20%2F&quote=Creating%20a%20TTY%20Simulator%20in%20Assembly%20Language%20on%20the%20VIC-20" target="_blank" title="Share on Facebook">Facebook</a></li>
    <li><a href="https://twitter.com/intent/tweet?source=https%3A%2F%2Ftechtinkering.com%2F2013%2F05%2F04%2Fcreating-a-tty-simulator-in-assembly-language-on-the-vic-20%2F&text=Creating%20a%20TTY%20Simulator%20in%20Assembly%20Language%20on%20the%20VIC-20:%0Ahttps%3A%2F%2Ftechtinkering.com%2F2013%2F05%2F04%2Fcreating-a-tty-simulator-in-assembly-language-on-the-vic-20%2F&via=TechTinkering" target="_blank" title="Tweet">Twitter</a></li>
    <li><a href="mailto:?subject=Creating%20a%20TTY%20Simulator%20in%20Assembly%20Language%20on%20the%20VIC-20&body=The%20Vicmon%20machine%20language%20cartridge%20is%20an%20excellent%20tool%20for%20exploring%20the%20Vic-20.%20%20This%20article%20and%20its%20associated%20video%20will%20show%20you%20how%20to%20use%20it%20to%20create%20a%20simple%20program%20that%20will%20change%20the%20n...:%0A%0Ahttps%3A%2F%2Ftechtinkering.com%2F2013%2F05%2F04%2Fcreating-a-tty-simulator-in-assembly-language-on-the-vic-20%2F" target="_blank" title="Send email">Email</a></li>
  </ul>
</div>

    <h2>Feedback/Discuss</h2>
    <div class="contact">
  <ul>


    <li><a href="mailto:techtinkering@vlifesystems.com?subject=Comment:%20Creating%20a%20TTY%20Simulator%20in%20Assembly%20Language%20on%20the%20VIC-20&body=Article%20URL:%20https%3A%2F%2Ftechtinkering.com%2F2013%2F05%2F04%2Fcreating-a-tty-simulator-in-assembly-language-on-the-vic-20%2F%0A" title="Send us an email">Email</a></li>
  </ul>
</div>
  </div>


    <div>
    <h2>Related Articles</h2>
    <div class="margin-buffer">
      <header>
  <h2><a href="/articles/getting-the-address-of-basic-variables-on-the-vic-20/">Getting the Address of BASIC Variables on the VIC-20</a></h2>
  <span class="post-meta">
      <ul class="tags">
          <li>#<a href="/articles/tag/assembly/">Assembly</a></li>
          <li>#<a href="/articles/tag/basic/">BASIC</a></li>
          <li>#<a href="/articles/tag/commodore/">Commodore</a></li>
          <li>#<a href="/articles/tag/programming/">Programming</a></li>
          <li>#<a href="/articles/tag/retro/">Retro</a></li>
          <li>#<a href="/articles/tag/vic-20/">VIC-20</a></li>
      </ul>
  </span>
</header>
<div>
  Getting the address of a BASIC variable can be useful if you want to pass data to a machine code routine or want to access the bytes of a variable directly to improve speed and reduce garbage collectio...
  &nbsp;
  <a class="readMore" href="/articles/getting-the-address-of-basic-variables-on-the-vic-20/">Read More</a>
</div>
<br />
      <header>
  <h2><a href="/articles/saving-and-loading-memory-on-the-vic-20/">Saving and Loading Memory on the VIC-20</a></h2>
  <span class="post-meta">
      <ul class="tags">
          <li>#<a href="/articles/tag/assembly/">Assembly</a></li>
          <li>#<a href="/articles/tag/basic/">BASIC</a></li>
          <li>#<a href="/articles/tag/commodore/">Commodore</a></li>
          <li>#<a href="/articles/tag/programming/">Programming</a></li>
          <li>#<a href="/articles/tag/retro/">Retro</a></li>
          <li>#<a href="/articles/tag/vic-20/">VIC-20</a></li>
      </ul>
  </span>
</header>
<div>
  Saving and loading memory is quite easy on the VIC-20 once you know how.  However, it isn't obvious how to do this and therefore this article will present a few simple ways of doing it from BASIC and A...
  &nbsp;
  <a class="readMore" href="/articles/saving-and-loading-memory-on-the-vic-20/">Read More</a>
</div>
<br />
      <header>
  <h2><a href="/articles/programming-in-assembly-with-vicmon-on-the-vic-20/">Programming in Assembly with VICMON on the VIC-20</a></h2>
  <span class="post-meta">
      <ul class="tags">
          <li>#<a href="/articles/tag/assembly/">Assembly</a></li>
          <li>#<a href="/articles/tag/commodore/">Commodore</a></li>
          <li>#<a href="/articles/tag/programming/">Programming</a></li>
          <li>#<a href="/articles/tag/retro/">Retro</a></li>
          <li>#<a href="/articles/tag/vic-20/">VIC-20</a></li>
      </ul>
  </span>
</header>
<div>
  VICMON is a machine language monitor released by Commodore in 1982 and is great for programming the VIC-20.  Its interactive nature means that it can often be quicker to develop via this rather than us...
  &nbsp;
  <a class="readMore" href="/articles/programming-in-assembly-with-vicmon-on-the-vic-20/">Read More</a>
</div>
<br />
      <header>
  <h2><a href="/articles/storing-machine-code-in-rem-statements-on-the-vic-20/">Storing Machine Code in REM Statements on the VIC-20</a></h2>
  <span class="post-meta">
      <ul class="tags">
          <li>#<a href="/articles/tag/assembly/">Assembly</a></li>
          <li>#<a href="/articles/tag/basic/">BASIC</a></li>
          <li>#<a href="/articles/tag/commodore/">Commodore</a></li>
          <li>#<a href="/articles/tag/programming/">Programming</a></li>
          <li>#<a href="/articles/tag/retro/">Retro</a></li>
          <li>#<a href="/articles/tag/vic-20/">VIC-20</a></li>
      </ul>
  </span>
</header>
<div>
  BASIC programs often contain machine code routines but they take up quite a lot of space in BASIC.  An interesting way to reduce the amount of space that they take is to store the machine code in REM s...
  &nbsp;
  <a class="readMore" href="/articles/storing-machine-code-in-rem-statements-on-the-vic-20/">Read More</a>
</div>
<br />
      <header>
  <h2><a href="/articles/code-and-data-in-display-memory-on-the-vic-20/">Code and Data in Display Memory on the VIC-20</a></h2>
  <span class="post-meta">
      <ul class="tags">
          <li>#<a href="/articles/tag/assembly/">Assembly</a></li>
          <li>#<a href="/articles/tag/commodore/">Commodore</a></li>
          <li>#<a href="/articles/tag/programming/">Programming</a></li>
          <li>#<a href="/articles/tag/retro/">Retro</a></li>
          <li>#<a href="/articles/tag/vic-20/">VIC-20</a></li>
      </ul>
  </span>
</header>
<div>
  The unexpanded Commodore VIC-20 only had 5K of RAM and therefore creative ways had to be found to maximize the available RAM.  The display memory would use some of this memory and therefore one option ...
  &nbsp;
  <a class="readMore" href="/articles/code-and-data-in-display-memory-on-the-vic-20/">Read More</a>
</div>
<br />
</div>
    </div>

<script>
  if (isUserFromUK()) {
    document.write(amznBanner);
  }
</script>
    </div>

    <footer>
  <nav>
    <div class="container">
      <div>
        <strong>Legal:</strong>
        <a href="/terms/">T & C</a>, <a href="/privacy/">Privacy Policy</a>
        &nbsp;
        <strong>Misc:</strong>
        <a href="https://github.com/lawrencewoodman/techtinkering.com" title="Fork TechTinkering On GitHub ">GitHub</a>
        <script>
          if (isUserFromUK()) {
            document.write('<br /><strong>Disclosure:<' +'/strong> As an Amazon Associate TechTinkering earns from qualifying purchases.');
          }
        </script>
      </div>
    </div>
  </nav>
</footer>
  </body>
</html>