<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
  <title>Compiling a Tcl Script into an Executable</title>
  <meta name="description" content="Locating Tcl scripts to load from an executable can be awkward if you want to make your program cross-platform.  An easier way is to compile a Tcl script directl">
  <meta name="keywords" content="Retro Vintage Programming Tinkering"/>

  <!-- *** Twitter Card *** -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@techtinkering">
  <meta name="twitter:title" content="Compiling a Tcl Script into an Executable">
  <meta name="twitter:description" content="Locating Tcl scripts to load from an executable can be awkward if you want to make your program cross-platform.  An easier way is to compile a Tcl script directl">
  <!-- *** Twitter Card *** -->

  <!-- *** Open Graph *** --->
  <meta property="og:type" content="website">
  <meta property="og:title" content="Compiling a Tcl Script into an Executable">
  <meta property="og:description" content="Locating Tcl scripts to load from an executable can be awkward if you want to make your program cross-platform.  An easier way is to compile a Tcl script directl">
  <meta property="og:url" content="https://techtinkering.com/2013/02/20/compiling-a-tcl-script-into-an-executable/">
  <!-- *** Open Graph *** --->

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-4388762-2"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-4388762-2');
  </script>

  <script>
    console.log('timeZone: '+Intl.DateTimeFormat().resolvedOptions().timeZone);
    function isUserFromUK() {
      return Intl.DateTimeFormat().resolvedOptions().timeZone == "Europe/London";
    }
  </script>

  <link href="/css/main.css" rel="stylesheet">
  <link href="/css/article.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" rel="stylesheet" type="text/css" />
  <link rel="canonical" href="https://techtinkering.com/2013/02/20/compiling-a-tcl-script-into-an-executable/">
  <link rel="alternate" type="application/rss+xml" title="TechTinkering - Retro Computers, Programming, General Technical Tinkering"
        href="https://feedproxy.google.com/TechTinkering" />

	<!-- ****** faviconit.com favicons ****** -->
	<link rel="shortcut icon" href="/favicon.ico">
	<link rel="icon" sizes="16x16 32x32 64x64" href="/favicon.ico">
	<!-- ****** faviconit.com favicons ****** -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>

  <script>
    if (isUserFromUK()) {
      console.log("No Google ADs - UK user");
    } else {
      console.log("Google ADs - not from uk");
      document.write('<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"><' + '/script>');
    }
  </script>

  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->

  <script>
    // Cookie Consent - https://cookieconsent.insites.com
    window.addEventListener("load", function(){
    window.cookieconsent.initialise({
      "palette": {
        "popup": {
          "background": "#252e39"
        },
        "button": {
          "background": "#14a7d0"
        }
      },
      "theme": "classic",
      "position": "top",
      "static": true,
      "content": {
        "message": "TechTinkering uses cookies for advertising, analytics, etc.",
        "href": "https://techtinkering.com/privacy/"
      }
    })});
  </script>

  <script>
    if (isUserFromUK()) {
      console.log("No Google Ads - uk user");
      console.log("Amazon Banner - from uk");
      // Amazon Prime Video Banner 728x90 and 300x250
      amznBanner='<div class="amazonBannerDesktop"><iframe src="https://rcm-eu.amazon-adsystem.com/e/cm?o=2&p=48&l=ur1&category=piv&banner=0E183RXMV88X6J8GJ002&f=ifr&linkID=a2c37aae0561f075af3356504493bdf0&t=techtinkering-21&tracking_id=techtinkering-21" width="728" height="90" scrolling="no" border="0" marginwidth="0" style="border:none;" frameborder="0" sandbox="allow-scripts allow-same-origin allow-popups allow-top-navigation-by-user-activation"><' + '/iframe><' +'/div><div class="amazonBannerMobile"><iframe src="https://rcm-eu.amazon-adsystem.com/e/cm?o=2&p=12&l=ur1&category=piv&banner=070GKT77WVHAHSRTHK02&f=ifr&linkID=0dc57b53bcc8f7ab67a385d51155e57a&t=techtinkering-21&tracking_id=techtinkering-21" width="300" height="250" scrolling="no" border="0" marginwidth="0" style="border:none;" frameborder="0" sandbox="allow-scripts allow-same-origin allow-popups allow-top-navigation-by-user-activation"><' + '/iframe><' + '/div>';
    } else {
      console.log("Google Ads - non-uk user");
      (adsbygoogle = window.adsbygoogle || []).push({
           google_ad_client: "ca-pub-1613732348909658",
           enable_page_level_ads: true
      });
    }
  </script>

</head>
  <body>
    <nav>
  <div class="container">
    <div class="navbar-header">
      <a href="/">TechTinkering</a><br />
      =============
    </div>

    <div class="contact">
      <ul>
        <li>
          <a href="https://twitter.com/TechTinkering" title="@TechTinkering on Twitter">Twitter</a>
        </li>
        <li>
          <a href="https://youtube.com/techtinkering" title="TechTinkering's YouTube Channel">YouTube</a>
        </li>
        <li>
          <a href="https://feeds.feedburner.com/TechTinkering" title="Subscribe to our RSS Feed">RSS</a>
        </li>
        <li>
          <a href="mailto:techtinkering@vlifesystems.com" title="Email us, we'd love to hear from you">Email</a>
        </li>
        <li>
          <a href="/useful-links/" title="Useful vintage computer links">Useful Links</a>
        </li>
      </ul>
    </div>
  </div>
</nav>
    <div id="content" class="container">
      <div class="margin-buffer">
    <article itemscope itemtype="http://schema.org/BlogPosting">
      <header>
        <a href="/2013/02/20/compiling-a-tcl-script-into-an-executable/" title="Compiling a Tcl Script into an Executable">
          <h1 itemprop="headline name">Compiling a Tcl Script into an Executable</h1>
        </a>
        <div>
            <time itemprop="datePublished"
                  datetime="2013-02-20">
              20 February 2013
            </time>
          <span itemscope itemprop="publisher"
                itemtype="http://schema.org/Organization">
            <meta itemprop="name" content="TechTinkering" />
            <meta itemprop="url" content="https://techtinkering.com" />
          </span>
          <span itemscope itemprop="author" itemtype="http://schema.org/Person">
            <a rel="author" itemprop="url" href="https://lawrencewoodman.github.io">
              <span itemprop="name">Lawrence Woodman</span>
            </a>
          </span>

          <ul class="tags">
              <li>#<a href="/articles/tag/c/">C</a></li>
              <li>#<a href="/articles/tag/programming/">Programming</a></li>
              <li>#<a href="/articles/tag/tcl/">Tcl</a></li>
          </ul>
        </div>
      </header>

      <script>
        if (isUserFromUK()) {
          document.write(amznBanner);
        }
      </script>

        <div itemprop="articleBody">
        <p>Locating Tcl scripts to load from an executable can be awkward if you want to make your program cross-platform.  An easier way is to compile a Tcl script directly into the executable and let that script find any other scripts needed.  This is particularly relevent as so many programs just use a single Tcl script to create a Tk GUI and therefore this should be as pain free as possible.</p>
<p>Any easy way around this is to turn your Tcl file into an array that can be included from your source file.  This article explores how to do this with Tcl and C.</p>
<h2>Converting the Tcl Script</h2>
<p>To include the Tcl script it needs to be converted into a C array.  This can be done from Unix with the <code>xxd -i</code> command.  So to convert <code>my.bin</code> to <code>my.bin.h</code> you would run:</p>
<pre><code class="language-bash">$ xxd -i my.tcl my.tcl.h
</code></pre>
<p>If don't have access to <code>xxd</code>, you can use <a href="https://github.com/LawrenceWoodman/bin2c">bin2c</a> downloadable as an archive from <a href="https://github.com/LawrenceWoodman/bin2c/tags">here</a>.  To do as above with <code>bin2c</code>:</p>
<pre><code class="language-bash">$ tclsh bin2c.tcl my.tcl my_tcl my.tcl.h
</code></pre>
<p>This will create a file similar to the following:</p>
<pre><code class="language-c">unsigned char my_tcl[] = {
  0x70, 0x75, 0x74, 0x73, 0x20, 0x22, 0x48, 0x65, 0x6c, 0x6c, 0x6f, 0x2c,
  0x20, 0x77, 0x6f, 0x72, 0x6c, 0x64, 0x21, 0x22, 0x0a, 0x70, 0x75, 0x74,
  0x73, 0x20, 0x22, 0x49, 0x20, 0x68, 0x6f, 0x70, 0x65, 0x20, 0x79, 0x6f,
  0x75, 0x20, 0x6c, 0x69, 0x6b, 0x65, 0x64, 0x20, 0x74, 0x68, 0x69, 0x73,
  0x20, 0x61, 0x72, 0x74, 0x69, 0x63, 0x6c, 0x65, 0x20, 0x66, 0x72, 0x6f,
  0x6d, 0x3a, 0x20, 0x68, 0x74, 0x74, 0x70, 0x3a, 0x2f, 0x2f, 0x74, 0x65,
  0x63, 0x68, 0x74, 0x69, 0x6e, 0x6b, 0x65, 0x72, 0x69, 0x6e, 0x67, 0x2e,
  0x63, 0x6f, 0x6d, 0x22, 0x0a
};
unsigned int my_tcl_len = 89;
</code></pre>
<h2>Loading the Tcl Script</h2>
<p>In the example below you can see that <code>my.tcl.h</code> has been included into the function which will load the script.  The array created above is then evaluated by <code>Tcl_EvalEx()</code> using the created array: <code>my_tcl</code>, and its associated length variable: <code>my_tcl_len</code>.</p>
<pre><code class="language-c">#include &lt;tcl.h&gt;

static Tcl_Interp *interp;

int
Script_init()
{
  // Include my.tcl which has been converted to a char array using xxd -i
  #include &quot;my.tcl.h&quot;

  interp = Tcl_CreateInterp();
  if (Tcl_Init(interp) == TCL_ERROR) { return 0; }

  if (Tcl_EvalEx(interp, my_tcl, my_tcl_len, 0) == TCL_ERROR ) {
    fprintf(stderr, &quot;Error in embedded my.tcl\n&quot;);
    fprintf(stderr, &quot;%s\n&quot;, Tcl_GetStringResult(interp));
    return 0;
  }

  return 1;
}
</code></pre>
<h2>Conclusion</h2>
<p>This process makes it much easier to distribute an executable.  Once an initial Tcl script has been loaded, you can use something like the <a href="https://github.com/LawrenceWoodman/xdgbasedir_tcl">xdgbasedir</a> module to easily locate other scripts for the program.  To automate this process, take a look at <a href="/2013/02/12/using-dynamically-generated-header-files-with-cmake">Using Dynamically Generated Header Files with CMake</a>.</p>
      </div>
    </article>
</div>

<script>
  if (isUserFromUK()) {
    document.write(amznBanner);
  }
</script>

  <div id="cclicence">
    <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
      <img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png" />
    </a>
    <br />
    <span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">Compiling a Tcl Script into an Executable</span>
    by <a xmlns:cc="http://creativecommons.org/ns#" href="https://techtinkering.com/2013/02/20/compiling-a-tcl-script-into-an-executable/" property="cc:attributionName" rel="cc:attributionURL">Lawrence Woodman</a>
   is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
   
  </div>


  <div class="discuss">
    <h2 style="margin-top:0;">Share This Post</h2>
    <div class="contact">
  <ul>
    <li><a href="http://www.reddit.com/submit?url=https%3A%2F%2Ftechtinkering.com%2F2013%2F02%2F20%2Fcompiling-a-tcl-script-into-an-executable%2F&title=Compiling%20a%20Tcl%20Script%20into%20an%20Executable" target="_blank" title="Submit to Reddit">Reddit</a></li>
    <li><a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Ftechtinkering.com%2F2013%2F02%2F20%2Fcompiling-a-tcl-script-into-an-executable%2F&quote=Compiling%20a%20Tcl%20Script%20into%20an%20Executable" target="_blank" title="Share on Facebook">Facebook</a></li>
    <li><a href="https://twitter.com/intent/tweet?source=https%3A%2F%2Ftechtinkering.com%2F2013%2F02%2F20%2Fcompiling-a-tcl-script-into-an-executable%2F&text=Compiling%20a%20Tcl%20Script%20into%20an%20Executable:%0Ahttps%3A%2F%2Ftechtinkering.com%2F2013%2F02%2F20%2Fcompiling-a-tcl-script-into-an-executable%2F&via=TechTinkering" target="_blank" title="Tweet">Twitter</a></li>
    <li><a href="mailto:?subject=Compiling%20a%20Tcl%20Script%20into%20an%20Executable&body=Locating%20Tcl%20scripts%20to%20load%20from%20an%20executable%20can%20be%20awkward%20if%20you%20want%20to%20make%20your%20program%20cross-platform.%20%20An%20easier%20way%20is%20to%20compile%20a%20Tcl%20script%20directly%20into%20the%20executable%20and%20let%20that%20scrip...:%0A%0Ahttps%3A%2F%2Ftechtinkering.com%2F2013%2F02%2F20%2Fcompiling-a-tcl-script-into-an-executable%2F" target="_blank" title="Send email">Email</a></li>
  </ul>
</div>

    <h2>Feedback/Discuss</h2>
    <div class="contact">
  <ul>


    <li><a href="mailto:techtinkering@vlifesystems.com?subject=Comment:%20Compiling%20a%20Tcl%20Script%20into%20an%20Executable&body=Article%20URL:%20https%3A%2F%2Ftechtinkering.com%2F2013%2F02%2F20%2Fcompiling-a-tcl-script-into-an-executable%2F%0A" title="Send us an email">Email</a></li>
  </ul>
</div>
  </div>


    <div>
    <h2>Related Articles</h2>
    <div class="margin-buffer">
      <header>
  <h2><a href="/articles/introducing-ornament-a-tcl-template-module/">Introducing Ornament a Tcl Template Module</a></h2>
  <span class="post-meta">
      <ul class="tags">
          <li>#<a href="/articles/tag/ornament/">Ornament</a></li>
          <li>#<a href="/articles/tag/programming/">Programming</a></li>
          <li>#<a href="/articles/tag/tcl/">Tcl</a></li>
      </ul>
  </span>
</header>
<div>
  Ornament is a Tcl template module that allows you to define, parse and compile a template to produce a script which can then be run using a safe interpreter.  The idea came from the Templates and subst...
  &nbsp;
  <a class="readMore" href="/articles/introducing-ornament-a-tcl-template-module/">Read More</a>
</div>
<br />
      <header>
  <h2><a href="/2013/02/27/xdgbasedir-a-tcl-module-to-access-the-xdg-base-directory-specification/">xdgbasedir: A Tcl Module to Access the XDG Base Directory Specification</a></h2>
  <span class="post-meta">
      <ul class="tags">
          <li>#<a href="/articles/tag/programming/">Programming</a></li>
          <li>#<a href="/articles/tag/tcl/">Tcl</a></li>
      </ul>
  </span>
</header>
<div>
  Unix has traditionally lacked a consistent way of storing user specific and system wide configuration and support files.  This has lead to a mess of dot files in a user's home directory and other assoc...
  &nbsp;
  <a class="readMore" href="/2013/02/27/xdgbasedir-a-tcl-module-to-access-the-xdg-base-directory-specification/">Read More</a>
</div>
<br />
      <header>
  <h2><a href="/2012/06/26/embedding-an-sdl-surface-in-a-tk-window/">Embedding an SDL Surface in a Tk Window</a></h2>
  <span class="post-meta">
      <ul class="tags">
          <li>#<a href="/articles/tag/programming/">Programming</a></li>
          <li>#<a href="/articles/tag/sdl/">SDL</a></li>
          <li>#<a href="/articles/tag/tcl/">Tcl</a></li>
          <li>#<a href="/articles/tag/tk/">Tk</a></li>
      </ul>
  </span>
</header>
<div>
  Tk is great, but sometimes it just isn't fast enough.  SDL is fast, but has no support for input dialogs and other GUI conventions.  By embedding an SDL surface in a Tk window you get the best of both ...
  &nbsp;
  <a class="readMore" href="/2012/06/26/embedding-an-sdl-surface-in-a-tk-window/">Read More</a>
</div>
<br />
      <header>
  <h2><a href="/2008/10/22/installing-the-hi-tech-z80-c-compiler-for-cpm/">Installing the HI-TECH Z80 C Compiler for CP/M</a></h2>
  <span class="post-meta">
      <ul class="tags">
          <li>#<a href="/articles/tag/c/">C</a></li>
          <li>#<a href="/articles/tag/cpm/">CP/M</a></li>
          <li>#<a href="/articles/tag/programming/">Programming</a></li>
          <li>#<a href="/articles/tag/retro/">Retro</a></li>
          <li>#<a href="/articles/tag/z80/">Z80</a></li>
      </ul>
  </span>
</header>
<div>
  My language of choice is C and I am currently getting more involved with the CP/M operating system.  I have therefore decided that it would be nice to have a C compiler working under CP/M.  There are a...
  &nbsp;
  <a class="readMore" href="/2008/10/22/installing-the-hi-tech-z80-c-compiler-for-cpm/">Read More</a>
</div>
<br />
      <header>
  <h2><a href="/articles/is-subleq-the-right-choice-for-a-vm/">Is SUBLEQ the Right Choice for a VM?</a></h2>
  <span class="post-meta">
      <ul class="tags">
          <li>#<a href="/articles/tag/programming/">Programming</a></li>
          <li>#<a href="/articles/tag/subleq/">SUBLEQ</a></li>
      </ul>
  </span>
</header>
<div>
  SUBLEQ is an interesting architecture because of its simplicity, adaptability and power.  It is therefore an attractive choice for a simple virtual machine.  However, this comes at a cost which we will...
  &nbsp;
  <a class="readMore" href="/articles/is-subleq-the-right-choice-for-a-vm/">Read More</a>
</div>
<br />
</div>
    </div>

<script>
  if (isUserFromUK()) {
    document.write(amznBanner);
  }
</script>
    </div>

    <footer>
  <nav>
    <div class="container">
      <div>
        <strong>Legal:</strong>
        <a href="/terms/">T & C</a>, <a href="/privacy/">Privacy Policy</a>
        &nbsp;
        <strong>Misc:</strong>
        <a href="https://github.com/lawrencewoodman/techtinkering.com" title="Fork TechTinkering On GitHub ">GitHub</a>
        <script>
          if (isUserFromUK()) {
            document.write('<br /><strong>Disclosure:<' +'/strong> As an Amazon Associate TechTinkering earns from qualifying purchases.');
          }
        </script>
      </div>
    </div>
  </nav>
</footer>
  </body>
</html>